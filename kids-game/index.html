<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BlueSphere Kids - El Arrecife M√°gico</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&display=swap');

        :root {
            --ocean-deep: #006994;
            --ocean-light: #48cae4;
            --sand: #f4e4bc;
            --coral: #ff8fa3;
            --glass: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.4);
            --text-dark: #0a2463;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(180deg, #89f7fe 0%, #66a6ff 100%);
            height: 100vh; /* Fallback */
            height: 100dvh; /* Altura din√°mica para celulares modernos */
            overflow: hidden;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            /* Previene el rebote el√°stico en iPhone */
            overscroll-behavior: none; 
        }

        .game-container {
            width: 90%;
            max-width: 1000px;
            height: 95%; /* Usamos casi toda la altura disponible */
            display: grid;
            grid-template-rows: auto 1fr auto;
            gap: 15px;
            box-sizing: border-box;
        }

        /* --- CABECERA --- */
        .real-data-header {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
            font-weight: 700;
            color: var(--text-dark);
            flex-wrap: wrap;
            gap: 10px;
        }

        /* --- √ÅREA DE JUEGO --- */
        .game-area {
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            border: 2px dashed rgba(255,255,255,0.3);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 10px;
            overflow: hidden;
            width: 100%;
            box-sizing: border-box;
        }

        /* Personaje Azulina */
        .character {
            position: absolute;
            top: 20px;
            left: 20px;
            text-align: center;
            animation: float 3s ease-in-out infinite;
            z-index: 10;
        }
        .character-icon { font-size: 50px; filter: drop-shadow(0 0 10px rgba(0,255,255,0.5)); }
        .character-name { font-size: 12px; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* Basura (Items Draggables) */
        .trash-item {
            position: absolute;
            font-size: 50px;
            cursor: grab;
            transition: transform 0.2s;
            user-select: none;
            z-index: 20;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2));
            /* Importante para touch */
            touch-action: none; 
        }
        .trash-item:active { cursor: grabbing; transform: scale(1.2); }

        /* Contenedores PC (Base) */
        .bin {
            width: 80px;
            height: 100px;
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: absolute;
            bottom: 20px;
            transition: transform 0.3s;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-bottom: 5px solid #ccc;
        }
        .bin:hover { transform: scale(1.05) translateY(-5px); }

        /* Posiciones PC */
        .plastic-bin { left: 10%; border-color: #ffcc00; }
        .paper-bin { left: 35%; border-color: #3366cc; }
        .glass-bin { left: 60%; border-color: #009933; }
        .organic-bin { left: 85%; border-color: #996633; }

        .bin-icon { font-size: 35px; margin-bottom: 5px; }
        .bin-label { font-size: 10px; font-weight: bold; color: #555; text-transform: uppercase; }

        /* Timer de Descomposici√≥n */
        .decay-timer {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.6);
            padding: 5px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: white;
        }

        /* --- PANELES INFERIORES --- */
        .score-panel {
            display: flex;
            justify-content: space-around;
            background: white;
            padding: 10px;
            border-radius: 20px;
            color: var(--text-dark);
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            flex-wrap: wrap;
            gap: 5px;
            font-size: 0.9rem;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            padding-bottom: 5px; /* Aire extra abajo */
        }

        .control-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 25px;
            background: white;
            color: var(--ocean-deep);
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.2s;
            font-family: 'Quicksand', sans-serif;
            text-decoration: none;
            font-size: 14px;
        }

        /* --- MODAL --- */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 30px;
            text-align: center;
            color: var(--text-dark);
            max-width: 85%;
            box-shadow: 0 0 50px rgba(0,255,255,0.5);
        }
        .modal-btn {
            margin-top: 15px;
            padding: 12px 30px;
            background: linear-gradient(90deg, #00c6ff, #0072ff);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Educaci√≥n */
        .education-panel {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            display: none;
            color: #333;
            box-shadow: 0 0 50px rgba(0,255,255,0.4);
            z-index: 50;
            max-width: 250px;
        }

        /* --- üì± CORRECCIONES MAESTRAS PARA CELULAR --- */
        @media (max-width: 768px) {
            .game-container {
                height: 100dvh; /* Altura din√°mica real */
                width: 98%;
                gap: 8px;
                padding: 5px 0;
            }

            /* Cabecera compacta */
            .real-data-header {
                padding: 8px;
                font-size: 0.7rem;
                justify-content: center;
                gap: 8px;
            }
            
            /* Botes Estilizados */
            .bin {
                width: 17%; /* Tama√±o ideal */
                height: 75px;
                font-size: 0.65rem;
                bottom: 10px;
            }
            .bin-icon { font-size: 24px; margin-bottom: 2px; }
            .bin-label { font-size: 7px; letter-spacing: -0.5px; }

            /* --- DISTRIBUCI√ìN PERFECTA --- */
            .plastic-bin { left: 2%; }
            .paper-bin   { left: 26%; }
            .glass-bin   { left: 51%; }
            
            /* TRUCO MAESTRO: Anclar a la derecha */
            /* En vez de left, usamos right: 2% */
            /* As√≠ NUNCA se saldr√° de la pantalla */
            .organic-bin { 
                left: auto; 
                right: 2%; 
            }

            .trash-item { font-size: 55px; }
            
            .score-panel {
                padding: 8px;
                font-size: 0.7rem;
            }
            
            .control-btn {
                padding: 8px 15px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="real-data-header">
            <div class="location-info">
                üåé <strong>Playa:</strong> <span id="beach-name">Del Carmen</span>
            </div>
            <div class="pollution-data">
                üóëÔ∏è <strong>Basura:</strong> 
                <span id="real-trash-count">2,540 kg</span>
            </div>
            <div class="impact-counter">
                üå± <strong>T√∫:</strong>
                <span id="player-impact">Reciclando...</span>
            </div>
        </div>
        
        <div class="game-area" id="game-area">
            <div id="azulina" class="character">
                <div class="character-icon">üê¢</div>
                <div class="character-name">Azulina</div>
            </div>
            
            <div class="bin plastic-bin" data-accepts="plastic">
                <div class="bin-icon">‚ôªÔ∏è</div>
                <div class="bin-label">PL√ÅSTICO</div>
            </div>
            
            <div class="bin paper-bin" data-accepts="paper">
                <div class="bin-icon">üìÑ</div>
                <div class="bin-label">PAPEL</div>
            </div>
            
            <div class="bin glass-bin" data-accepts="glass">
                <div class="bin-icon">ü•õ</div>
                <div class="bin-label">VIDRIO</div>
            </div>
            
            <div class="bin organic-bin" data-accepts="organic">
                <div class="bin-icon">üçé</div>
                <div class="bin-label">ORG√ÅNICO</div>
            </div>
            
            <div class="decay-timer">
                <div class="timer-icon">‚è≥</div>
                <div class="timer-text">
                    Vida: <span id="decay-clock">---</span>
                </div>
            </div>

            <div class="education-panel">
                <h3>üìö ¬øSab√≠as que?</h3>
                <p id="fact-text">Cargando dato...</p>
            </div>
        </div>
        
        <div class="score-panel">
            <div class="score-item">
                <span class="score-label">Limpio:</span>
                <span id="score-count" class="score-value">0</span>
            </div>
            <div class="score-item">
                <span class="score-label">Impacto:</span>
                <span id="real-impact" class="score-value">0.00 kg</span>
            </div>
            <div class="score-item">
                <span class="score-label">Nivel:</span>
                <span id="level-progress" class="score-value">0/10</span>
            </div>
        </div>
        
        <div class="controls">
            <button id="btn-new-game" class="control-btn">üîÑ Reiniciar</button>
            <a href="../index.html" class="control-btn">üè† Salir</a>
        </div>
    </div>
    
    <div id="victory-modal" class="modal">
        <div class="modal-content">
            <h2>üéâ ¬°Oc√©ano Limpio!</h2>
            <p>Has limpiado <span id="final-score">0</span> objetos.</p>
            <p><strong>Impacto real:</strong> <span id="final-impact">0.00</span> kg menos en el mar.</p>
            <p>üèÜ ¬°Gracias Guardi√°n!</p>
            <button id="btn-continue" class="modal-btn">üåä Jugar otra vez</button>
        </div>
    </div>
    
    <script>
        // CONFIGURACI√ìN
        const trashTypes = [
            { name: 'Botella', type: 'plastic', icon: 'üß¥', decay: '450 a√±os' },
            { name: 'Bolsa', type: 'plastic', icon: 'üõçÔ∏è', decay: '150 a√±os' },
            { name: 'Peri√≥dico', type: 'paper', icon: 'üì∞', decay: '6 semanas' },
            { name: 'Caja', type: 'paper', icon: 'üì¶', decay: '2 meses' },
            { name: 'Botella Vidrio', type: 'glass', icon: 'üçæ', decay: '4000 a√±os' },
            { name: 'Manzana', type: 'organic', icon: 'üçé', decay: '2 meses' },
            { name: 'Pl√°tano', type: 'organic', icon: 'üçå', decay: '1 mes' }
        ];

        const facts = [
            "¬°Una botella de pl√°stico tarda 450 a√±os en desaparecer!",
            "El vidrio es 100% reciclable y se puede usar infinitas veces.",
            "Si reciclas una tonelada de papel, salvas 17 √°rboles.",
            "El 80% de la contaminaci√≥n del oc√©ano viene de la tierra."
        ];

        let score = 0;
        let realImpactKg = 0;
        let levelItems = 0;
        const MAX_ITEMS_LEVEL = 10;
        let activeTrash = null;

        // ELEMENTOS
        const gameArea = document.getElementById('game-area');
        const scoreEl = document.getElementById('score-count');
        const impactEl = document.getElementById('real-impact');
        const progressEl = document.getElementById('level-progress');
        const decayClock = document.getElementById('decay-clock');
        const factPanel = document.querySelector('.education-panel');
        const factText = document.getElementById('fact-text');
        const victoryModal = document.getElementById('victory-modal');

        // SONIDOS
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            if (type === 'good') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(500, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.2);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            }
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        // INICIAR
        function initGame() {
            score = 0;
            realImpactKg = 0;
            levelItems = 0;
            updateUI();
            spawnTrash();
        }

        // GENERAR BASURA
        function spawnTrash() {
            if (levelItems >= MAX_ITEMS_LEVEL) {
                endLevel();
                return;
            }

            const existing = document.querySelector('.trash-item');
            if (existing) existing.remove();

            const itemData = trashTypes[Math.floor(Math.random() * trashTypes.length)];
            const trash = document.createElement('div');
            trash.classList.add('trash-item');
            trash.textContent = itemData.icon;
            trash.dataset.type = itemData.type;
            
            // Posici√≥n aleatoria
            const maxX = gameArea.offsetWidth - 80;
            trash.style.left = Math.max(20, Math.random() * maxX) + 'px';
            trash.style.top = '50px';
            
            // DRAG EVENTS
            trash.draggable = true;
            
            trash.addEventListener('touchstart', handleTouchStart, {passive: false});
            trash.addEventListener('touchmove', handleTouchMove, {passive: false});
            trash.addEventListener('touchend', handleTouchEnd);

            trash.addEventListener('dragstart', (e) => {
                activeTrash = trash;
                decayClock.textContent = itemData.decay;
                e.dataTransfer.setData('text/plain', itemData.type);
                setTimeout(() => trash.style.opacity = '0.5', 0);
            });
            
            trash.addEventListener('dragend', () => {
                trash.style.opacity = '1';
                activeTrash = null;
            });

            gameArea.appendChild(trash);
        }

        // L√ìGICA TOUCH
        let initialX, initialY;
        function handleTouchStart(e) {
            e.preventDefault();
            initialX = e.touches[0].clientX - e.target.offsetLeft;
            initialY = e.touches[0].clientY - e.target.offsetTop;
            activeTrash = e.target;
            const type = activeTrash.dataset.type;
            const item = trashTypes.find(t => t.type === type);
            if(item) decayClock.textContent = item.decay;
        }
        function handleTouchMove(e) {
            e.preventDefault();
            if (activeTrash) {
                const currentX = e.touches[0].clientX - initialX;
                const currentY = e.touches[0].clientY - initialY;
                activeTrash.style.left = `${currentX}px`;
                activeTrash.style.top = `${currentY}px`;
            }
        }
        function handleTouchEnd(e) {
            if (!activeTrash) return;
            const bins = document.querySelectorAll('.bin');
            const trashRect = activeTrash.getBoundingClientRect();
            let dropped = false;

            bins.forEach(bin => {
                const binRect = bin.getBoundingClientRect();
                if (
                    trashRect.left < binRect.right &&
                    trashRect.right > binRect.left &&
                    trashRect.top < binRect.bottom &&
                    trashRect.bottom > binRect.top
                ) {
                    dropped = true;
                    checkRecycle(activeTrash.dataset.type, bin.dataset.accepts);
                }
            });

            if (!dropped) {
                activeTrash.style.top = '50px';
            }
            activeTrash = null;
        }

        document.querySelectorAll('.bin').forEach(bin => {
            bin.addEventListener('dragover', e => e.preventDefault());
            bin.addEventListener('drop', e => {
                e.preventDefault();
                const type = e.dataTransfer.getData('text/plain');
                checkRecycle(type, bin.dataset.accepts);
            });
        });

        function checkRecycle(trashType, binType) {
            if (trashType === binType) {
                handleSuccess();
            } else {
                handleMistake();
            }
        }

        function handleSuccess() {
            playSound('good');
            score++;
            realImpactKg += 0.5;
            levelItems++;
            
            const trash = document.querySelector('.trash-item');
            if(trash) trash.remove();

            if (Math.random() > 0.7) {
                factPanel.style.display = 'block';
                factText.textContent = facts[Math.floor(Math.random() * facts.length)];
                setTimeout(() => factPanel.style.display = 'none', 3000);
            }

            updateUI();
            setTimeout(spawnTrash, 1000);
        }

        function handleMistake() {
            playSound('bad');
            alert("¬°Ese no es el contenedor correcto!");
            const trash = document.querySelector('.trash-item');
            if(trash) {
                trash.style.top = '50px';
                trash.style.opacity = '1';
            }
        }

        function updateUI() {
            scoreEl.textContent = score;
            impactEl.textContent = realImpactKg.toFixed(2) + ' kg';
            progressEl.textContent = `${levelItems}/${MAX_ITEMS_LEVEL}`;
        }

        function endLevel() {
            victoryModal.style.display = 'flex';
            document.getElementById('final-score').textContent = score;
            document.getElementById('final-impact').textContent = realImpactKg.toFixed(2);
        }

        document.getElementById('btn-new-game').addEventListener('click', () => {
            victoryModal.style.display = 'none';
            initGame();
        });

        document.getElementById('btn-continue').addEventListener('click', () => {
            victoryModal.style.display = 'none';
            initGame();
        });

        initGame();
    </script>
</body>
</html>
