<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>üåç Ritual de Seguimiento Cu√°ntico ‚Äî Sistema Nervioso Planetario BlueSphere</title>
    <meta name="description" content="Ceremonia diaria de conexi√≥n con GAIA. Registra tus h√°bitos regenerativos como ofrendas al campo cu√°ntico colectivo." />
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* ==================== PALETA CEREMONIAL ==================== */
        :root {
            --bg: #010912;
            --card: rgba(6, 30, 40, 0.85);
            --glow: #00c4ff;
            --light: #8feaff;
            --muted: #b7e9ff;
            --quantum: #00ffaa;
            --success: #3ddc84;
            --warning: #ffb74d;
            --observation: #9d4edd;
            --ancestral: #ff6d00;
            --legacy: #ffea00;
        }

        /* ==================== UNIVERSO VISUAL ==================== */
        * { box-sizing: border-box; margin: 0; }
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: radial-gradient(circle at 50% 50%, #061e28 0%, #010912 100%);
            color: #eaffff;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        #particles-js { 
            position: fixed; 
            inset: 0; 
            z-index: 0; 
            pointer-events: none; 
        }

        .wrap {
            position: relative; 
            z-index: 2; 
            max-width: 1200px; 
            margin: 0 auto;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        /* ==================== COMPONENTES SAGRADOS ==================== */
        .portal-header {
            text-align: center; 
            margin-bottom: 30px; 
            padding: 30px;
            background: rgba(6, 30, 40, 0.6); 
            border-radius: 25px;
            border: 1px solid rgba(0, 196, 255, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 0 0 50px rgba(0, 196, 255, 0.1);
        }

        .portal-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #fff, var(--glow), var(--quantum));
            -webkit-background-clip: text; 
            background-clip: text; 
            color: transparent;
            text-shadow: 0 0 30px rgba(0, 196, 255, 0.5);
            margin-bottom: 10px; 
            font-weight: 900;
        }

        .card-ceremonial {
            background: var(--card); 
            border-radius: 25px; 
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            margin-bottom: 25px;
        }

        /* TABS DE CATEGOR√çAS */
        .categoria-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .categoria-tab {
            padding: 12px 24px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 196, 255, 0.2);
            color: var(--muted);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .categoria-tab:hover {
            background: rgba(0, 196, 255, 0.1);
            border-color: var(--glow);
        }

        .categoria-tab.active {
            background: linear-gradient(135deg, rgba(0, 196, 255, 0.2), rgba(0, 255, 170, 0.1));
            border-color: var(--quantum);
            color: white;
            box-shadow: 0 0 20px rgba(0, 255, 170, 0.2);
        }

        /* GRID DE ACCIONES - AJUSTADO PARA 21 H√ÅBITOS */
        .acciones-grid {
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); 
            gap: 12px;
            margin: 20px 0;
        }

        .accion-label {
            display: flex; 
            align-items: center; 
            gap: 12px;
            background: rgba(255, 255, 255, 0.05); 
            padding: 12px;
            border-radius: 15px; 
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer; 
            transition: all 0.3s; 
            position: relative; 
            overflow: hidden;
            min-height: 80px;
        }

        .accion-label:hover { 
            border-color: var(--glow); 
            background: rgba(0, 196, 255, 0.1); 
        }

        .accion-chk { display: none; }

        .accion-chk:checked + .accion-content {
            color: var(--quantum); 
            text-shadow: 0 0 10px var(--quantum);
        }

        .accion-label:has(.accion-chk:checked) {
            border-color: var(--quantum); 
            background: rgba(0, 255, 170, 0.15);
            box-shadow: 0 0 20px rgba(0, 255, 170, 0.2);
        }

        /* ESTILOS ESPECIALES PARA NUEVOS H√ÅBITOS */
        .accion-label.observation-mode:has(.accion-chk:checked) {
            border-color: var(--observation);
            background: rgba(157, 78, 221, 0.15);
            box-shadow: 0 0 20px rgba(157, 78, 221, 0.3);
        }

        .accion-label.ancestral-healing:has(.accion-chk:checked) {
            border-color: var(--ancestral);
            background: rgba(255, 109, 0, 0.15);
            box-shadow: 0 0 20px rgba(255, 109, 0, 0.3);
        }

        .accion-label.legacy-future:has(.accion-chk:checked) {
            border-color: var(--legacy);
            background: rgba(255, 234, 0, 0.15);
            box-shadow: 0 0 20px rgba(255, 234, 0, 0.3);
        }

        .orb-icon { 
            font-size: 1.6rem; 
            min-width: 35px; 
            text-align: center; 
        }

        /* INTENCI√ìN SINCRONIZADA */
        .synchronized-intention {
            background: linear-gradient(135deg, rgba(157, 78, 221, 0.1), rgba(0, 196, 255, 0.1));
            border: 1px solid var(--observation);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            text-align: center;
        }

        .intention-text {
            font-size: 1.1rem;
            color: var(--light);
            font-style: italic;
            margin-bottom: 10px;
        }

        .intention-focus {
            color: var(--observation);
            font-weight: bold;
            font-size: 1.2rem;
            text-shadow: 0 0 10px rgba(157, 78, 221, 0.5);
        }

        /* IMPACTO VISUAL */
        .impacto-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .impacto-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(0, 255, 170, 0.2);
        }

        .impacto-valor {
            font-size: 2rem;
            font-weight: bold;
            color: var(--quantum);
            text-shadow: 0 0 10px rgba(0, 255, 170, 0.5);
        }

        /* BOTONES */
        .btn-quantum {
            width: 100%; 
            padding: 18px; 
            border-radius: 15px; 
            font-weight: 900;
            background: linear-gradient(135deg, var(--quantum), var(--glow));
            color: #002731; 
            border: none; 
            cursor: pointer;
            box-shadow: 0 0 30px rgba(0, 255, 170, 0.3);
            font-size: 1.2rem; 
            text-transform: uppercase; 
            letter-spacing: 2px;
            transition: transform 0.2s;
            margin-top: 20px;
        }

        .btn-quantum:hover { 
            transform: scale(1.02); 
            box-shadow: 0 0 50px rgba(0, 255, 170, 0.5); 
        }

        /* LOADER & RESULTADOS */
        .loader-box { 
            display: none; 
            text-align: center; 
            padding: 20px; 
        }

        .spinner {
            width: 50px; 
            height: 50px; 
            border: 5px solid rgba(0, 255, 170, 0.3);
            border-top-color: var(--quantum); 
            border-radius: 50%;
            animation: spin 1s linear infinite; 
            margin: 0 auto;
        }

        @keyframes spin { 
            to { transform: rotate(360deg); } 
        }

        .success-message {
            display: none; 
            background: rgba(61, 220, 132, 0.1); 
            border: 1px solid var(--success);
            padding: 20px; 
            border-radius: 15px; 
            text-align: center; 
            margin-top: 20px;
            animation: fadeIn 0.5s;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="particles-js"></div>

    <div class="wrap">
        
        <header class="portal-header">
            <h1 class="portal-title">üåç RITUAL DE SEGUIMIENTO CU√ÅNTICO</h1>
            <p style="color: var(--muted); letter-spacing: 3px; font-size: 0.9rem;">
                SISTEMA NERVIOSO PLANETARIO ACTIVO ‚Ä¢ MODO SINCRONIZADO
            </p>
        </header>

        <!-- INTENCI√ìN SINCRONIZADA COLECTIVA -->
        <div class="synchronized-intention card-ceremonial">
            <div class="intention-text">üåÄ Esta semana, todos nuestros pulsos est√°n enfocados en:</div>
            <div class="intention-focus" id="currentIntention">REGENERAR LOS CICLOS DEL AGUA Y SANAR LA MEMORIA H√çDRICA</div>
            <div style="font-size: 0.8rem; color: var(--muted); margin-top: 10px;">
                Sincron√≠a colectiva activa: <span id="syncCount">1,247</span> guardianes resonando
            </div>
        </div>

        <div class="card-ceremonial">
            
            <!-- C√ìDIGO DE GUARDI√ÅN -->
            <div style="margin-bottom: 30px;">
                <label style="color: var(--glow); font-weight: bold; margin-bottom: 10px; display: block;">
                    üîÆ C√ìDIGO DE GUARDI√ÅN ‚Ä¢ MODO OBSERVACI√ìN ACTIVO
                </label>
              <input id="codigoInput" class="input-ceremonial" 
       placeholder="Ej: GPR-AQUA-ZIRIUX-000051"
       value="GPR-AQUA-ZIRIUX-000051">
                <div id="statusCodigo" style="margin-top: 10px; font-size: 0.9rem; color: var(--muted);">
                    üåÄ Escaneando frecuencia guardi√°n...
                </div>
            </div>

            <!-- TABS DE CATEGOR√çAS -->
            <div class="categoria-tabs">
                <div class="categoria-tab active" data-categoria="basico">üåø 18 H√ÅBITOS B√ÅSICOS</div>
                <div class="categoria-tab" data-categoria="avanzado">üî• 3 H√ÅBITOS AVANZADOS</div>
                <div class="categoria-tab" data-categoria="estados">üí´ ESTADOS DE SER</div>
            </div>

            <h3 style="color: var(--light); border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-bottom: 20px;">
                üåø OFRENDAS DEL D√çA ‚Ä¢ CICLO COMPLETO DE REGENERACI√ìN
            </h3>

            <!-- CATEGOR√çA: 18 H√ÅBITOS B√ÅSICOS -->
            <div id="categoriaBasico" class="categoria-contenido">
                <div class="acciones-grid">
                    <!-- H√ÅBITOS EXISTENTES (18) CON LOS 3 NUEVOS INTEGRADOS -->
                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="menos_plastico">
                        <div class="orb-icon">ü•§</div>
                        <div class="accion-content">
                            <strong>Reducci√≥n Pl√°sticos</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Ra√≠z ‚Ä¢ Obras Fide</span>
                        </div>
                    </label>

                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="transporte_limpio">
                        <div class="orb-icon">üö≤</div>
                        <div class="accion-content">
                            <strong>Transporte Sagrado</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Ra√≠z ‚Ä¢ Obras Fide</span>
                        </div>
                    </label>

                    <!-- NUEVO H√ÅBITO 1: LIMPIEZA DE PLAYAS/ESPACIOS -->
                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="limpieza_playas">
                        <div class="orb-icon">üèñÔ∏è</div>
                        <div class="accion-content">
                            <strong>Limpieza Ceremonial de Costas</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Ra√≠z ‚Ä¢ Sanaci√≥n Espacios</span>
                        </div>
                    </label>

                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="reparar_objetos">
                        <div class="orb-icon">üß©</div>
                        <div class="accion-content">
                            <strong>Kintsugi / Reparar</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Ra√≠z ‚Ä¢ Obras Fide</span>
                        </div>
                    </label>

                    <!-- NUEVO H√ÅBITO 2: COMPOSTAJE/RESIDUOS COCINA -->
                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="compostaje">
                        <div class="orb-icon">ü™±</div>
                        <div class="accion-content">
                            <strong>Alquimia de Residuos Cocina</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Sacro ‚Ä¢ Ciclo Cerrado</span>
                        </div>
                    </label>

                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="ahorro_agua">
                        <div class="orb-icon">üíß</div>
                        <div class="accion-content">
                            <strong>Bendici√≥n del Agua</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Sacro ‚Ä¢ Obras Serra</span>
                        </div>
                    </label>

                    <!-- NUEVO H√ÅBITO 3: GESTI√ìN AVANZADA RESIDUOS -->
                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="gestion_residuos">
                        <div class="orb-icon">üóëÔ∏è</div>
                        <div class="accion-content">
                            <strong>Gesti√≥n Consciente de Residuos</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Ra√≠z ‚Ä¢ 5R Sagradas</span>
                        </div>
                    </label>

                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="sin_desperdicio">
                        <div class="orb-icon">ü•ó</div>
                        <div class="accion-content">
                            <strong>Eucarist√≠a Alimentaria</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Sacro ‚Ä¢ Obras Serra</span>
                        </div>
                    </label>

                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="cosmetica_natural">
                        <div class="orb-icon">üß¥</div>
                        <div class="accion-content">
                            <strong>Ung√ºentos Naturales</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Sacro ‚Ä¢ Obras Serra</span>
                        </div>
                    </label>

                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="energia_ahorro">
                        <div class="orb-icon">üîã</div>
                        <div class="accion-content">
                            <strong>Meditaci√≥n Energ√©tica</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Plexo ‚Ä¢ Obras Trades</span>
                        </div>
                    </label>

                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="consumo_local">
                        <div class="orb-icon">üõí</div>
                        <div class="accion-content">
                            <strong>Compra Voto Sagrado</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Plexo ‚Ä¢ Obras Serra</span>
                        </div>
                    </label>

                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="reforestacion">
                        <div class="orb-icon">üå≥</div>
                        <div class="accion-content">
                            <strong>Plantaci√≥n Ceremonial</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Coraz√≥n ‚Ä¢ Obras Correos</span>
                        </div>
                    </label>

                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="dia_sin_carne">
                        <div class="orb-icon">üåø</div>
                        <div class="accion-content">
                            <strong>Ayuno de Compasi√≥n</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Coraz√≥n ‚Ä¢ Obras Correos</span>
                        </div>
                    </label>

                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="polinizadores">
                        <div class="orb-icon">üêù</div>
                        <div class="accion-content">
                            <strong>Santuario Abejas</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Coraz√≥n ‚Ä¢ Obras Correos</span>
                        </div>
                    </label>

                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="comercio_justo">
                        <div class="orb-icon">ü§ù</div>
                        <div class="accion-content">
                            <strong>Comercio Justo</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Coraz√≥n ‚Ä¢ Obras Correos</span>
                        </div>
                    </label>

                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="activismo_digital">
                        <div class="orb-icon">üì¢</div>
                        <div class="accion-content">
                            <strong>Evangelio Digital</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Garganta ‚Ä¢ Torre Ojo</span>
                        </div>
                    </label>

                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="digital_limpio">
                        <div class="orb-icon">üìµ</div>
                        <div class="accion-content">
                            <strong>Silencio Digital</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Tercer Ojo ‚Ä¢ Obras Gerg√©tas</span>
                        </div>
                    </label>

                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="formacion_ambiental">
                        <div class="orb-icon">üìö</div>
                        <div class="accion-content">
                            <strong>Transmisi√≥n Sabidur√≠a</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Tercer Ojo ‚Ä¢ Obras Gerg√©tas</span>
                        </div>
                    </label>

                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="voluntariado">
                        <div class="orb-icon">üôå</div>
                        <div class="accion-content">
                            <strong>Servicio Sagrado</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Chakra Corona ‚Ä¢ Obras Correos</span>
                        </div>
                    </label>
                </div>
            </div>

            <!-- CATEGOR√çA: 3 H√ÅBITOS AVANZADOS -->
            <div id="categoriaAvanzado" class="categoria-contenido hidden">
                <div class="acciones-grid">
                    <!-- H√ÅBITO AVANZADO 1: SANACI√ìN ANCESTRAL -->
                    <label class="accion-label ancestral-healing">
                        <input type="checkbox" class="accion-chk" value="sanacion_ancestral">
                        <div class="orb-icon">üïäÔ∏è</div>
                        <div class="accion-content">
                            <strong>Sanaci√≥n de Memoria Ecol√≥gica</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Reparaci√≥n del Pasado ‚Ä¢ Tiempo Profundo</span>
                            <div style="font-size:0.7rem; margin-top: 5px; color: var(--ancestral);">
                                Honrar especies extintas, plantar en su memoria
                            </div>
                        </div>
                    </label>

                    <!-- H√ÅBITO AVANZADO 2: LEGADO SIETEGENERACIONAL -->
                    <label class="accion-label legacy-future">
                        <input type="checkbox" class="accion-chk" value="legado_sietegeneracional">
                        <div class="orb-icon">üå≥</div>
                        <div class="accion-content">
                            <strong>Legado Sietegeneracional</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Siembra del Futuro ‚Ä¢ Tiempo Profundo</span>
                            <div style="font-size:0.7rem; margin-top: 5px; color: var(--legacy);">
                                Acci√≥n cuyos frutos ver√°n los nietos de tus nietos
                            </div>
                        </div>
                    </label>

                    <!-- H√ÅBITO AVANZADO 3: PACTO DE RECIPROCIDAD -->
                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="pacto_reciprocidad">
                        <div class="orb-icon">ü§≤</div>
                        <div class="accion-content">
                            <strong>Pacto de Reciprocidad con Especie</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Conexi√≥n No-Humana ‚Ä¢ Alianza Sagrada</span>
                            <div style="font-size:0.7rem; margin-top: 5px; color: var(--light);">
                                Elegir una especie y realizar acci√≥n espec√≠fica para ella
                            </div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- CATEGOR√çA: ESTADOS DE SER -->
            <div id="categoriaEstados" class="categoria-contenido hidden">
                <div class="acciones-grid">
                    <!-- ESTADO 1: OBSERVACI√ìN SILENCIOSA -->
                    <label class="accion-label observation-mode">
                        <input type="checkbox" class="accion-chk" value="observacion_silenciosa">
                        <div class="orb-icon">üåÄ</div>
                        <div class="accion-content">
                            <strong>Modo Observaci√≥n Silenciosa</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Estado de Ser ‚Ä¢ No-Hacer</span>
                            <div style="font-size:0.7rem; margin-top: 5px; color: var(--observation);">
                                No suma puntos. Transforma la calidad de todos los dem√°s h√°bitos
                            </div>
                        </div>
                    </label>

                    <!-- ESTADO 2: EMPAT√çA SIST√âMICA -->
                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="empatia_sistemica">
                        <div class="orb-icon">üåê</div>
                        <div class="accion-content">
                            <strong>Empat√≠a Sist√©mica Activa</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Estado de Ser ‚Ä¢ Conexi√≥n</span>
                            <div style="font-size:0.7rem; margin-top: 5px; color: var(--light);">
                                Percibir interconexiones antes de actuar
                            </div>
                        </div>
                    </label>

                    <!-- ESTADO 3: GRATITUD RADICAL -->
                    <label class="accion-label">
                        <input type="checkbox" class="accion-chk" value="gratitud_radical">
                        <div class="orb-icon">üôè</div>
                        <div class="accion-content">
                            <strong>Gratitud Radical por lo Existente</strong><br>
                            <span style="font-size:0.75rem; opacity:0.7;">Estado de Ser ‚Ä¢ Reconocimiento</span>
                            <div style="font-size:0.7rem; margin-top: 5px; color: var(--light);">
                                Agradecer lo que ya funciona en el sistema
                            </div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- PANEL DE IMPACTO VISUAL -->
            <div class="impacto-container">
                <div class="impacto-card">
                    <div style="font-size:0.9rem; color:var(--muted);">IMPACTO DIRECT0</div>
                    <div class="impacto-valor" id="impactoDirecto">0.0</div>
                    <div style="font-size:0.8rem;">kg CO‚ÇÇ evitados</div>
                </div>
                <div class="impacto-card">
                    <div style="font-size:0.9rem; color:var(--muted);">IMPACTO SIST√âMICO</div>
                    <div class="impacto-valor" id="impactoSistemico">0.0</div>
                    <div style="font-size:0.8rem;">puntos de regeneraci√≥n</div>
                </div>
                <div class="impacto-card">
                    <div style="font-size:0.9rem; color:var(--muted);">SINCRON√çA COLECTIVA</div>
                    <div class="impacto-valor" id="sincroniaColectiva">0%</div>
                    <div style="font-size:0.8rem;">alineaci√≥n con intenci√≥n</div>
                </div>
            </div>

            <!-- REFLEXI√ìN -->
            <div style="margin: 20px 0;">
                <label style="display:block; margin-bottom:10px; color:var(--muted);">
                    üìú MENSAJE PARA EL CAMPO CU√ÅNTICO ‚Ä¢ REFLEXI√ìN DE HOY
                </label>
                <textarea id="comentarioInput" class="input-ceremonial" rows="3" 
                    placeholder="Describe tu experiencia, sincron√≠as percibidas, o el mensaje que env√≠as hoy al sistema nervioso planetario..."></textarea>
            </div>

            <!-- BOT√ìN DE ENV√çO -->
            <button id="btnRegistrar" class="btn-quantum">
                ‚ö° ENVIAR PULSO CU√ÅNTICO AL SISTEMA NERVIOSO PLANETARIO
            </button>

            <!-- LOADER -->
            <div id="loader" class="loader-box">
                <div class="spinner"></div>
                <p style="margin-top: 10px; color: var(--quantum);">
                    Sincronizando con Supabase ‚Ä¢ Codificando pulso en la red GAIA...
                </p>
            </div>

            <!-- MENSAJE DE √âXITO -->
            <div id="successMsg" class="success-message">
                <h3 style="color: var(--success);">üåÄ PULSO CU√ÅNTICO REGISTRADO</h3>
                <p>Tu ofrenda ha sido codificada en el n√∫cleo de BlueSphere y resonar√° en la red planetaria.</p>
                <p style="font-size:0.9rem; margin-top:10px;">
                    <strong>Generando Reporte de Eco-Sincron√≠a...</strong> (disponible en 24h)
                </p>
            </div>

        </div>

        <!-- SECCI√ìN DE MEDALLAS -->
        <div id="seccionMedallas" class="card-ceremonial hidden">
            <h3 style="color: #FFD700; text-align: center;">üèÜ TUS MEDALLAS SAGRADAS ‚Ä¢ RECONOCIMIENTOS DEL SISTEMA</h3>
            <div id="gridMedallas" class="medalla-grid"></div>
        </div>

        <!-- SECCI√ìN DE REPORTE DE ECO-SINCRON√çA (OCULTA INICIALMENTE) -->
        <div id="seccionReporte" class="card-ceremonial hidden">
            <h3 style="color: var(--observation); text-align: center;">üìä REPORTE DE ECO-SINCRON√çA ‚Ä¢ TU IMPACTO EN LA RED</h3>
            <div id="reporteContenido" style="padding: 20px;">
                <!-- Se generar√° din√°micamente -->
            </div>
        </div>

    </div>

    <script>
        // ==================== CONFIGURACI√ìN SUPABASE ====================
        const SUPABASE_URL = 'https://ophicpcbgdgzthjamzoz.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9waGljcGNiZ2RnenRoamFtem96Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3MjgwMzUsImV4cCI6MjA4MDMwNDAzNX0.K55Tk-cdbAFDOtGrIMN7vYFaJAccrsD6UdOrARt1P5c';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // ==================== SISTEMA DE IMPACTOS AVANZADO ====================
        const IMPACTOS_AVANZADOS = {
            // H√ÅBITOS B√ÅSICOS (18 originales + 3 nuevos)
            'menos_plastico': 2.0,
            'transporte_limpio': 3.5,
            'limpieza_playas': 10.0,           // NUEVO: Alto impacto directo
            'reparar_objetos': 2.0,
            'compostaje': 6.0,                 // NUEVO: Impacto sist√©mico medio-alto
            'ahorro_agua': 3.0,
            'gestion_residuos': 5.0,           // NUEVO: Impacto sist√©mico
            'sin_desperdicio': 4.0,
            'cosmetica_natural': 2.5,
            'energia_ahorro': 3.0,
            'consumo_local': 3.5,
            'reforestacion': 8.0,
            'dia_sin_carne': 4.5,
            'polinizadores': 5.0,
            'comercio_justo': 3.0,
            'activismo_digital': 1.5,
            'digital_limpio': 1.0,
            'formacion_ambiental': 2.0,
            'voluntariado': 4.0,

            // H√ÅBITOS AVANZADOS (Nuevos - alto impacto sist√©mico)
            'sanacion_ancestral': 7.0,         // Reparaci√≥n del pasado
            'legado_sietegeneracional': 9.0,   // Futuro profundo
            'pacto_reciprocidad': 6.0,         // Conexi√≥n no-humana

            // ESTADOS DE SER (No suman impacto directo, pero multiplican)
            'observacion_silenciosa': 0.0,     // Multiplica calidad
            'empatia_sistemica': 0.0,          // Mejora conexi√≥n
            'gratitud_radical': 0.0            // Aumenta resonancia
        };

        // ==================== INTENCIONES SINCRONIZADAS ====================
        const INTENCIONES_SEMANALES = [
            "REGENERAR LOS CICLOS DEL AGUA Y SANAR LA MEMORIA H√çDRICA",
            "FORTALECER LA RED DE POLINIZADORES Y SERES ALADOS",
            "REGENERAR SUELOS Y COMPLETAR CICLOS DE NUTRIENTES",
            "REDUCIR LA CARGA ENERG√âTICA DEL SISTEMA PLANETARIO",
            "SANAR RELACIONES ENTRE COMUNIDADES HUMANAS Y NO-HUMANAS",
            "ACTIVAR MEMORIA ANCESTRAL DE CONVIVENCIA CON LA TIERRA"
        ];

        // ==================== VARIABLES GLOBALES ====================
        let codigoGuardian = '';
        let intencionActiva = INTENCIONES_SEMANALES[0];
        let modoObservacion = false;
        let impactoDirecto = 0;
        let impactoSistemico = 0;

        // ==================== INICIALIZACI√ìN ====================
        document.addEventListener('DOMContentLoaded', async () => {
            // 1. Configurar part√≠culas
            inicializarParticulas();

            // 2. Detectar c√≥digo de guardi√°n
            await inicializarCodigoGuardian();

            // 3. Configurar sistema de pesta√±as
            configurarTabs();

            // 4. Configurar checkboxes y c√°lculos
            configurarSistemaCalculos();

            // 5. Configurar bot√≥n de registro
            configurarBotonRegistro();

            // 6. Inicializar intenci√≥n semanal
            inicializarIntencionSemanal();
        });

        // ==================== FUNCIONES PRINCIPALES ====================

        function inicializarParticulas() {
            particlesJS("particles-js", {
                particles: {
                    number: { value: 100 },
                    color: { value: ["#00ffaa", "#00c4ff", "#9d4edd"] },
                    opacity: { value: 0.3 },
                    size: { value: 3 },
                    line_linked: {
                        enable: true,
                        color: "#00c4ff",
                        opacity: 0.2,
                        width: 1
                    }
                }
            });
        }

        async function inicializarCodigoGuardian() {
            const params = new URLSearchParams(window.location.search);
            codigoGuardian = params.get('codigo') || '';

            const codigoInput = document.getElementById('codigoInput');
            const statusCodigo = document.getElementById('statusCodigo');

            if (codigoGuardian) {
                codigoInput.value = codigoGuardian;
                statusCodigo.innerHTML = `<span style="color:#3ddc84">üåÄ Sincronizado con Portal Azul ‚Ä¢ Frecuencia estable</span>`;
                
                // Cargar historial y medallas
                await cargarMedallas(codigoGuardian);
                await cargarReporteEcoSincronia(codigoGuardian);
            } else {
                statusCodigo.innerHTML = `<span style="color:#ffb74d">‚ö†Ô∏è Modo Manual (Ingresa tu c√≥digo de guardi√°n)</span>`;
                codigoInput.removeAttribute('readonly');
                codigoInput.addEventListener('change', function() {
                    codigoGuardian = this.value.trim();
                    if (codigoGuardian.length >= 10) {
                        cargarMedallas(codigoGuardian);
                    }
                });
            }
        }

        function configurarTabs() {
            const tabs = document.querySelectorAll('.categoria-tab');
            const contenidos = document.querySelectorAll('.categoria-contenido');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remover clase activa de todos
                    tabs.forEach(t => t.classList.remove('active'));
                    contenidos.forEach(c => c.classList.add('hidden'));

                    // Activar tab clickeado
                    tab.classList.add('active');
                    const categoria = tab.dataset.categoria;
                    document.getElementById(`categoria${categoria.charAt(0).toUpperCase() + categoria.slice(1)}`)
                        .classList.remove('hidden');
                });
            });
        }

        function configurarSistemaCalculos() {
            const checkboxes = document.querySelectorAll('.accion-chk');
            
            checkboxes.forEach(chk => {
                chk.addEventListener('change', calcularImpactos);
            });

            // Calcular inicialmente
            calcularImpactos();
        }

        function calcularImpactos() {
            const checkboxes = document.querySelectorAll('.accion-chk');
            
            // Resetear valores
            impactoDirecto = 0;
            impactoSistemico = 0;
            modoObservacion = false;

            // Contadores para sincron√≠a
            let habitosBasicos = 0;
            let habitosAvanzados = 0;
            let estadosSer = 0;

            checkboxes.forEach(chk => {
                if (chk.checked) {
                    const valor = chk.value;
                    
                    // Impacto directo
                    if (IMPACTOS_AVANZADOS[valor] > 0) {
                        impactoDirecto += IMPACTOS_AVANZADOS[valor];
                    }

                    // Detectar modo observaci√≥n
                    if (valor === 'observacion_silenciosa') {
                        modoObservacion = true;
                    }

                    // Contar por categor√≠a para impacto sist√©mico
                    if (valor.includes('sanacion') || valor.includes('legado') || valor.includes('pacto')) {
                        habitosAvanzados++;
                    } else if (valor.includes('observacion') || valor.includes('empatia') || valor.includes('gratitud')) {
                        estadosSer++;
                    } else {
                        habitosBasicos++;
                    }
                }
            });

            // Calcular impacto sist√©mico (f√≥rmula avanzada)
            impactoSistemico = (
                (habitosBasicos * 1) +
                (habitosAvanzados * 3) +
                (estadosSer * 2)
            );

            // Aplicar multiplicador de modo observaci√≥n
            if (modoObservacion) {
                impactoSistemico *= 1.5;
            }

            // Calcular sincron√≠a colectiva (simulada)
            const sincroniaColectiva = Math.min(100, Math.floor((habitosBasicos / 18) * 100));

            // Actualizar UI
            document.getElementById('impactoDirecto').textContent = impactoDirecto.toFixed(1);
            document.getElementById('impactoSistemico').textContent = impactoSistemico.toFixed(1);
            document.getElementById('sincroniaColectiva').textContent = `${sincroniaColectiva}%`;

            // Actualizar contador de sincron√≠a
            document.getElementById('syncCount').textContent = 
                Math.floor(1247 * (sincroniaColectiva / 100)).toLocaleString();
        }

        function inicializarIntencionSemanal() {
            // Obtener semana del a√±o para rotar intenciones
            const ahora = new Date();
            const inicioAno = new Date(ahora.getFullYear(), 0, 1);
            const diffTiempo = ahora - inicioAno;
            const semanaDelAno = Math.floor(diffTiempo / (1000 * 60 * 60 * 24 * 7));
            
            const indiceIntencion = semanaDelAno % INTENCIONES_SEMANALES.length;
            intencionActiva = INTENCIONES_SEMANALES[indiceIntencion];
            
            document.getElementById('currentIntention').textContent = intencionActiva;
        }

       function configurarBotonRegistro() {
    const btnRegistrar = document.getElementById('btnRegistrar');
    
    btnRegistrar.addEventListener('click', async () => {
        // 1. OBTENER C√ìDIGO
        const codigoInput = document.getElementById('codigoInput');
        const codigoGuardian = codigoInput.value.trim();
        
        if (!codigoGuardian || codigoGuardian.length < 10) {
            alert("üåÄ Ingresa tu c√≥digo de guardi√°n");
            codigoInput.focus();
            return;
        }
        
        // 2. VALIDAR ACCIONES
        if (impactoDirecto === 0 && !modoObservacion) {
            alert("üåø Selecciona al menos una ofrenda");
            return;
        }

        // 3. PREPARAR DATOS
        const checkboxes = document.querySelectorAll('.accion-chk');
        const acciones = Array.from(checkboxes)
            .filter(c => c.checked)
            .map(c => c.value)
            .join(', ');
        const comentario = document.getElementById('comentarioInput').value;

        // 4. MOSTRAR LOADER
        document.getElementById('loader').style.display = 'block';
        btnRegistrar.style.display = 'none';

        try {
            // 5. INSERTAR EN SUPABASE (SIN .select())
            const { error } = await supabase
                .from('seguimiento')
                .insert({
                    codigo_guardian: codigoGuardian,
                    acciones_realizadas: acciones,
                    impacto_directo: impactoDirecto,
                    impacto_sistemico: impactoSistemico,
                    modo_observacion: modoObservacion,
                    intencion_sincronizada: intencionActiva,
                    comentario: comentario
                });

            if (error) throw error;

            // 6. √âXITO
            console.log('‚úÖ Registro guardado');
            document.getElementById('loader').style.display = 'none';
            document.getElementById('successMsg').style.display = 'block';

            // 7. RESETEAR
            setTimeout(() => {
                document.getElementById('successMsg').style.display = 'none';
                btnRegistrar.style.display = 'block';
                document.querySelectorAll('.accion-chk').forEach(c => c.checked = false);
                calcularImpactos();
                document.getElementById('comentarioInput').value = '';
            }, 3000);

        } catch (error) {
            console.error('Error:', error);
            alert("üåÄ Error: " + error.message);
            document.getElementById('loader').style.display = 'none';
            btnRegistrar.style.display = 'block';
        }
    });
}

        async function cargarMedallas(codigo) {
            const { data, error } = await supabase
                .from('seguimiento')
                .select('*')
                .eq('codigo_guardian', codigo);

            if (error || !data || data.length === 0) {
                document.getElementById('seccionMedallas').classList.add('hidden');
                return;
            }

            // Mostrar secci√≥n
            document.getElementById('seccionMedallas').classList.remove('hidden');
            const grid = document.getElementById('gridMedallas');
            
            let html = '';
            const totalRegistros = data.length;
            const impactoTotal = data.reduce((sum, item) => sum + (item.impacto_directo || 0), 0);

            // MEDALLAS B√ÅSICAS
            if (totalRegistros >= 1) {
                html += `<div class="medalla-item">
                    <div style="font-size:2rem">üå±</div>
                    <div style="font-weight:bold; color:#FFD700">Primer Pulso</div>
                    <div style="font-size:0.7rem;">Iniciaci√≥n en la red</div>
                </div>`;
            }

            if (totalRegistros >= 7) {
                html += `<div class="medalla-item">
                    <div style="font-size:2rem">üîÆ</div>
                    <div style="font-weight:bold; color:#FFD700">Ritual Semanal</div>
                    <div style="font-size:0.7rem;">7 d√≠as consecutivos</div>
                </div>`;
            }

            if (totalRegistros >= 30) {
                html += `<div class="medalla-item">
                    <div style="font-size:2rem">üåï</div>
                    <div style="font-weight:bold; color:#FFD700">Ciclo Lunar</div>
                    <div style="font-size:0.7rem;">30 pulsos registrados</div>
                </div>`;
            }

            // MEDALLAS AVANZADAS
            if (impactoTotal > 100) {
                html += `<div class="medalla-item">
                    <div style="font-size:2rem">üíé</div>
                    <div style="font-weight:bold; color:#00ffaa">Impacto Regenerativo</div>
                    <div style="font-size:0.7rem;">+100kg CO‚ÇÇ evitados</div>
                </div>`;
            }

            // Verificar si tiene h√°bitos avanzados
            const tieneAvanzados = data.some(item => 
                item.acciones_realizadas && 
                (item.acciones_realizadas.includes('sanacion_ancestral') || 
                 item.acciones_realizadas.includes('legado_sietegeneracional'))
            );

            if (tieneAvanzados) {
                html += `<div class="medalla-item">
                    <div style="font-size:2rem">üï∞Ô∏è</div>
                    <div style="font-weight:bold; color:#ff6d00">Guardi√°n del Tiempo</div>
                    <div style="font-size:0.7rem;">Acciones en tiempo profundo</div>
                </div>`;
            }

            // Verificar modo observaci√≥n
            const tieneObservacion = data.some(item => item.modo_observacion);
            if (tieneObservacion) {
                html += `<div class="medalla-item">
                    <div style="font-size:2rem">üåÄ</div>
                    <div style="font-weight:bold; color:#9d4edd">Observador Silencioso</div>
                    <div style="font-size:0.7rem;">Estado de ser activado</div>
                </div>`;
            }

            grid.innerHTML = html;
        }

        async function generarReporteEcoSincronia(codigo) {
            const { data, error } = await supabase
                .from('seguimiento')
                .select('*')
                .eq('codigo_guardian', codigo)
                .order('fecha_reporte', { ascending: false })
                .limit(30);

            if (error || !data || data.length === 0) return;

            // Calcular estad√≠sticas
            const totalPulsos = data.length;
            const impactoTotal = data.reduce((sum, item) => sum + (item.impacto_directo || 0), 0);
            const impactoPromedio = impactoTotal / totalPulsos;
            
            // H√°bitos m√°s frecuentes
            const habitosFrecuencia = {};
            data.forEach(item => {
                if (item.acciones_realizadas) {
                    item.acciones_realizadas.split(', ').forEach(habito => {
                        habitosFrecuencia[habito] = (habitosFrecuencia[habito] || 0) + 1;
                    });
                }
            });

            const habitoMasFrecuente = Object.keys(habitosFrecuencia)
                .reduce((a, b) => habitosFrecuencia[a] > habitosFrecuencia[b] ? a : b, '');

            // Generar reporte narrativo
            let reporteHTML = `
                <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 15px; margin-bottom: 20px;">
                    <h4 style="color: var(--light); margin-bottom: 15px;">üìà TU SINCRON√çA CON LA RED</h4>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                        <div>
                            <div style="font-size: 0.9rem; color: var(--muted);">Pulsos Totales</div>
                            <div style="font-size: 2rem; color: var(--quantum);">${totalPulsos}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.9rem; color: var(--muted);">Impacto Total</div>
                            <div style="font-size: 2rem; color: var(--quantum);">${impactoTotal.toFixed(1)}</div>
                            <div style="font-size: 0.8rem;">kg CO‚ÇÇ evitados</div>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4 style="color: var(--light);">üåÄ PATRONES DE SINCRON√çA DETECTADOS</h4>
                        <p style="color: var(--muted); line-height: 1.6;">
                            Tu h√°bito m√°s frecuente es <strong style="color: var(--quantum);">"${traducirHabito(habitoMasFrecuente)}"</strong>.
                            ${totalPulsos >= 10 ? 'Mantienes una constancia notable en tu pr√°ctica regenerativa.' : 'Est√°s estableciendo los fundamentos de tu pr√°ctica.'}
                        </p>
                        
                        ${impactoPromedio > 5 ? 
                            `<p style="color: var(--success); margin-top: 10px;">
                                ‚ö° Tu impacto promedio por d√≠a (${impactoPromedio.toFixed(1)} puntos) est√° por encima del promedio de la red.
                                Est√°s generando ondas significativas en el sistema nervioso planetario.
                            </p>` : 
                            `<p style="color: var(--muted); margin-top: 10px;">
                                üå± Cada pulso, sin importar su magnitud, fortalece la red. La consistencia es la clave.
                            </p>`
                        }
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="mostrarReporteCompleto()" style="
                        padding: 10px 20px;
                        background: linear-gradient(135deg, var(--observation), var(--glow));
                        border: none;
                        border-radius: 10px;
                        color: white;
                        cursor: pointer;
                    ">
                        üìä VER REPORTE DE SINCRON√çA COMPLETO
                    </button>
                </div>
            `;

            document.getElementById('reporteContenido').innerHTML = reporteHTML;
            document.getElementById('seccionReporte').classList.remove('hidden');
        }

        async function cargarReporteEcoSincronia(codigo) {
            // Similar a generarReporte pero para carga inicial
            // Implementaci√≥n simplificada
        }

        function traducirHabito(valor) {
            const traducciones = {
                'limpieza_playas': 'Limpieza Ceremonial de Costas',
                'compostaje': 'Alquimia de Residuos Cocina',
                'gestion_residuos': 'Gesti√≥n Consciente de Residuos',
                'sanacion_ancestral': 'Sanaci√≥n de Memoria Ecol√≥gica',
                'legado_sietegeneracional': 'Legado Sietegeneracional',
                'pacto_reciprocidad': 'Pacto de Reciprocidad',
                'observacion_silenciosa': 'Observaci√≥n Silenciosa',
                // Agregar m√°s traducciones seg√∫n sea necesario
            };
            
            return traducciones[valor] || valor.replace(/_/g, ' ').toUpperCase();
        }

        function mostrarReporteCompleto() {
            // Implementaci√≥n para mostrar reporte detallado
            alert("üåÄ Esta funcionalidad se activar√° en la pr√≥xima actualizaci√≥n del sistema nervioso planetario.");
        }

        // ==================== INICIALIZACI√ìN FINAL ====================
        console.log(`
            üåç SISTEMA NERVIOSO PLANETARIO - BLUESPHERE CONSCIOUSNESS
            ========================================================
            Versi√≥n: 2.0.0 ‚Ä¢ C√≥digo Maestro Completo
            Modo: Regeneraci√≥n Cu√°ntica Avanzada
            H√°bitos: 21 b√°sicos + 3 avanzados + 3 estados de ser
            Estado: Sincronizado con Supabase
            
            üîÆ "Cada pulso es un latido en el coraz√≥n de Gaia"
        `);
    </script>
</body>
</html>
