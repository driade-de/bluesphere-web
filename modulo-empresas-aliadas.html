<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Validaci√≥n BlueSphere</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body style="background:#041016; color:#ffffff; font-family:Arial, sans-serif; padding:20px;">

<h1 style="color:#4fc3f7;">üîë Acceso Sagrado ‚Äì BlueSphere</h1>
<p>Introduce tu c√≥digo oficial para activar tu acceso al Portal del Pacto Azul.</p>

<div style="max-width:420px; margin-top:30px; padding:22px; background:#07212a; border-radius:14px; border:1px solid rgba(127,206,255,0.1);">

  <div style="text-align:center; margin-bottom:20px;">
    <img src="/img/logos/bluesphere.svg" style="height:60px; margin-bottom:10px;">
    <div style="font-weight:800; font-size:1.3rem;">BLUEsphere</div>
    <div style="color:#cfefff; font-size:0.9rem;">Sufijo: üåäBS</div>
  </div>

  <label style="display:block; margin-bottom:8px; font-weight:700;">Ingresa tu c√≥digo</label>
  <input id="inputCodigo" type="text"
    placeholder="BLUESPHERE-000001-üåäBS"
    style="width:100%; padding:12px; border-radius:8px; border:1px solid #4fc3f7; background:#021219; color:#fff; margin-bottom:14px;">

  <button id="btnValidar"
    style="width:100%; padding:14px; border-radius:10px; background:#ffd700; color:#041016; font-weight:800; border:none; cursor:pointer;">
    Validar & Entrar al Portal
  </button>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<script>
  const SUPABASE_URL = 'https://ophicpcbgdgzthjamzoz.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9waGljcGNiZ2RnenRoamFtem96Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3MjgwMzUsImV4cCI6MjA4MDMwNDAzNX0.K55Tk-cdbAFDOtGrIMN7vYFaJAccrsD6UdOrARt1P5c';

  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  const inputCodigo = document.getElementById('inputCodigo');
  const btnValidar = document.getElementById('btnValidar');

  btnValidar.addEventListener('click', validarCodigo);

  inputCodigo.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') validarCodigo();
  });

  async function validarCodigo() {
    const cod = inputCodigo.value.trim();

    if (!cod) {
      alert('Ingresa tu c√≥digo');
      return;
    }

    const { data, error } = await supabase
      .from('codigos')
      .select('*')
      .eq('codigo', cod)
      .single();

    if (error || !data) {
      alert('‚ùå C√≥digo inv√°lido');
      return;
    }

    if (data.usado === true) {
      alert('‚ö†Ô∏è Este c√≥digo ya fue utilizado');
      return;
    }

    await supabase
      .from('codigos')
      .update({ usado: true })
      .eq('id', data.id);

    alert('‚úÖ C√≥digo v√°lido. Accediendo al Portal...');
    window.location.href = '/portal-pacto-azul.html?codigo=' + encodeURIComponent(cod);
  }
</script>

</body>
</html>
