<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Empresas Aliadas - BlueSphere</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg: #041016;
      --card: #07212a;
      --accent: #4fc3f7;
      --gold: #ffd700;
      --white: #ffffff;
      --muted: #c8eaff;
    }
    
    body {
      background: var(--bg);
      color: var(--white);
      font-family: 'Segoe UI', system-ui, sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .logo {
      font-size: 3rem;
      background: linear-gradient(135deg, var(--accent), #81d4fa);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 800;
      margin-bottom: 10px;
    }
    
    .subtitle {
      color: var(--muted);
      font-size: 1.2rem;
      max-width: 600px;
      margin: 0 auto;
    }
    
    .empresas-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin: 40px 0;
    }
    
    .empresa-btn {
      background: linear-gradient(135deg, #0a2a3a, #083042);
      border: 2px solid rgba(79, 195, 247, 0.2);
      border-radius: 12px;
      padding: 25px 20px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .empresa-btn:hover {
      transform: translateY(-5px);
      border-color: var(--accent);
      box-shadow: 0 10px 20px rgba(79, 195, 247, 0.2);
    }
    
    .empresa-btn .icon {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    
    .empresa-btn .name {
      font-size: 1.1rem;
      margin-bottom: 5px;
    }
    
    .empresa-btn .sector {
      font-size: 0.85rem;
      color: var(--muted);
      opacity: 0.9;
    }
    
    .empresa-btn.demo {
      opacity: 0.8;
      border-style: dashed;
    }
    
    .empresa-btn.demo:hover {
      opacity: 1;
    }
    
    .empresa-btn.real {
      border-color: var(--gold);
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), #083042);
    }
    
    .empresa-btn.real:hover {
      border-color: var(--gold);
      box-shadow: 0 10px 20px rgba(255, 215, 0, 0.2);
    }
    
    .validation-card {
      background: var(--card);
      border-radius: 14px;
      padding: 25px;
      border: 1px solid rgba(127, 206, 255, 0.1);
      max-width: 500px;
      margin: 40px auto;
    }
    
    .input-group {
      margin-bottom: 20px;
    }
    
    .input-label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: var(--accent);
    }
    
    .input-field {
      width: 100%;
      padding: 14px;
      border-radius: 8px;
      border: 2px solid rgba(79, 195, 247, 0.3);
      background: #021219;
      color: var(--white);
      font-size: 1rem;
    }
    
    .input-field:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(79, 195, 247, 0.2);
    }
    
    .validate-btn {
      width: 100%;
      padding: 16px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--gold), #ffed4e);
      color: #041016;
      font-weight: 800;
      border: none;
      cursor: pointer;
      font-size: 1.1rem;
      transition: all 0.3s;
    }
    
    .validate-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
    }
    
    .info-box {
      background: linear-gradient(90deg, rgba(61, 220, 132, 0.1), rgba(127, 206, 255, 0.05));
      border-radius: 12px;
      padding: 20px;
      margin-top: 30px;
      border-left: 4px solid #3ddc84;
    }
    
    .info-title {
      color: #3ddc84;
      font-weight: 700;
      margin-bottom: 10px;
    }
    
    .footer {
      text-align: center;
      color: var(--muted);
      margin-top: 50px;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.9rem;
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
  </style>
</head>

<body>
  <div class="header">
    <div class="logo">ğŸŒŠ BlueSphere</div>
    <div class="subtitle">Portal de acceso para clientes de nuestras empresas aliadas guardianas</div>
  </div>

  <h2 style="color: var(--accent); text-align: center; margin-bottom: 20px;">ğŸ¢ Selecciona tu empresa guardiana</h2>
  <p style="text-align: center; color: var(--muted); margin-bottom: 30px; max-width: 800px; margin-left: auto; margin-right: auto;">
    Estas empresas han elegido ser guardianas del planeta. Si eres cliente de alguna, selecciÃ³nala para acceder.
  </p>

  <div class="empresas-grid">
    <!-- 11 Empresas Demo -->
    <button class="empresa-btn demo" data-empresa="ecotech">
      <div class="icon">ğŸŒ¿</div>
      <div class="name">EcoTech Solutions</div>
      <div class="sector">TecnologÃ­a Sostenible</div>
    </button>
    
    <button class="empresa-btn demo" data-empresa="greenlog">
      <div class="icon">ğŸšš</div>
      <div class="name">Green Logistics</div>
      <div class="sector">LogÃ­stica Verde</div>
    </button>
    
    <button class="empresa-btn demo" data-empresa="aquapure">
      <div class="icon">ğŸ’§</div>
      <div class="name">AquaPure Systems</div>
      <div class="sector">PurificaciÃ³n de Agua</div>
    </button>
    
    <button class="empresa-btn demo" data-empresa="solaris">
      <div class="icon">â˜€ï¸</div>
      <div class="name">Solaris Energy</div>
      <div class="sector">EnergÃ­a Solar</div>
    </button>
    
    <button class="empresa-btn demo" data-empresa="biopack">
      <div class="icon">ğŸ“¦</div>
      <div class="name">BioPack Materials</div>
      <div class="sector">Embalaje EcolÃ³gico</div>
    </button>
    
    <button class="empresa-btn demo" data-empresa="verdex">
      <div class="icon">ğŸŒ³</div>
      <div class="name">VerdeX Reforest</div>
      <div class="sector">ReforestaciÃ³n</div>
    </button>
    
    <button class="empresa-btn demo" data-empresa="cyclos">
      <div class="icon">ğŸ”„</div>
      <div class="name">Cyclos Circular</div>
      <div class="sector">EconomÃ­a Circular</div>
    </button>
    
    <button class="empresa-btn demo" data-empresa="terragen">
      <div class="icon">ğŸŒ</div>
      <div class="name">TerraGen Foods</div>
      <div class="sector">Alimentos OrgÃ¡nicos</div>
    </button>
    
    <button class="empresa-btn demo" data-empresa="cleanmob">
      <div class="icon">ğŸš²</div>
      <div class="name">Clean Mobility</div>
      <div class="sector">Movilidad Limpia</div>
    </button>
    
    <button class="empresa-btn demo" data-empresa="oceanix">
      <div class="icon">ğŸŒŠ</div>
      <div class="name">Oceanix Tech</div>
      <div class="sector">TecnologÃ­a Marina</div>
    </button>
    
    <button class="empresa-btn demo" data-empresa="urbangreen">
      <div class="icon">ğŸ™ï¸</div>
      <div class="name">UrbanGreen</div>
      <div class="sector">Agricultura Urbana</div>
    </button>
    
    <!-- BlueSphere Real -->
    <button class="empresa-btn real pulse" id="bluesphereBtn">
      <div class="icon">ğŸŒŠ</div>
      <div class="name">BlueSphere Alliance</div>
      <div class="sector">Acceso Directo</div>
    </button>
  </div>

  <div class="validation-card">
    <div class="input-group">
      <label class="input-label">ğŸ”‘ Â¿Ya tienes cÃ³digo? Ingresa tu cÃ³digo Ãºnico:</label>
      <input type="text" id="inputCodigo" class="input-field" 
             placeholder="Ej: BLUESPHERE-000001-ğŸŒŠBS o GPR-AQUA-0069">
    </div>
    
    <button id="btnValidar" class="validate-btn">
      Validar & Entrar al Portal
    </button>
  </div>

  <div class="info-box">
    <div class="info-title">â„¹ï¸ InformaciÃ³n para empresas</div>
    <p style="color: var(--muted); line-height: 1.6;">
      Cada empresa guardiana recibe cÃ³digos Ãºnicos para distribuir entre sus clientes. 
      Cuando los clientes registran sus acciones ambientales, el impacto se suma al dashboard 
      de la empresa, demostrando su compromiso real con el planeta.
      <br><br>
      <strong>Â¿Tu empresa quiere ser guardiana?</strong> ContÃ¡ctanos: alianzas@bluesphere.org
    </p>
  </div>

  <div class="footer">
    <p>BlueSphere Â© 2024 | Sistema de Conciencia Planetaria</p>
    <p style="margin-top: 10px; opacity: 0.8;">Portal oficial para empresas aliadas y sus clientes</p>
  </div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  
  <script>
    const SUPABASE_URL = 'https://ophicpcbgdgzthjamzoz.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9waGljcGNiZ2RnenRoamFtem96Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3MjgwMzUsImV4cCI6MjA4MDMwNDAzNX0.K55Tk-cdbAFDOtGrIMN7vYFaJAccrsD6UdOrARt1P5c';

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Elementos
    const inputCodigo = document.getElementById('inputCodigo');
    const btnValidar = document.getElementById('btnValidar');
    const bluesphereBtn = document.getElementById('bluesphereBtn');

    // Eventos
    btnValidar.addEventListener('click', validarCodigo);
    inputCodigo.addEventListener('keydown', (e) => e.key === 'Enter' && validarCodigo());
    
    // BotÃ³n BlueSphere - auto-completa cÃ³digo demo
    bluesphereBtn.addEventListener('click', () => {
      inputCodigo.value = 'BLUESPHERE-000001-ğŸŒŠBS';
      inputCodigo.focus();
    });
    
    // Botones empresas demo - muestran modal informativo
    document.querySelectorAll('.empresa-btn.demo').forEach(btn => {
      btn.addEventListener('click', function() {
        const empresa = this.getAttribute('data-empresa');
        const nombre = this.querySelector('.name').textContent;
        const sector = this.querySelector('.sector').textContent;
        
        // CÃ³digo demo para esta empresa
        const codigosDemo = {
          'ecotech': 'ECOTECH-2024-ğŸŒŠBS',
          'greenlog': 'GREENLOG-2024-ğŸŒŠBS',
          'aquapure': 'AQUAPURE-2024-ğŸŒŠBS',
          'solaris': 'SOLARIS-2024-ğŸŒŠBS',
          'biopack': 'BIOPACK-2024-ğŸŒŠBS',
          'verdex': 'VERDEX-2024-ğŸŒŠBS',
          'cyclos': 'CYCLOS-2024-ğŸŒŠBS',
          'terragen': 'TERRAGEN-2024-ğŸŒŠBS',
          'cleanmob': 'CLEANMOB-2024-ğŸŒŠBS',
          'oceanix': 'OCEANIX-2024-ğŸŒŠBS',
          'urbangreen': 'URBANGREEN-2024-ğŸŒŠBS'
        };
        
        const codigoDemo = codigosDemo[empresa];
        
        // Modal simple
        if(confirm(`${nombre} (${sector})\n\nCÃ³digo de ejemplo: ${codigoDemo}\n\nÂ¿Quieres probar este cÃ³digo demo?`)) {
          inputCodigo.value = codigoDemo;
          inputCodigo.focus();
        }
      });
    });

    // FunciÃ³n validaciÃ³n (igual que antes)
    async function validarCodigo() {
      const cod = inputCodigo.value.trim();

      if (!cod) {
        alert('Ingresa tu cÃ³digo');
        return;
      }

      const { data, error } = await supabase
        .from('codigos')
        .select('*')
        .eq('codigo', cod)
        .single();

      if (error || !data) {
        // Si es formato GPR-AQUA (guardianes), permitir acceso
        if (cod.startsWith('GPR-AQUA-')) {
          alert('âœ… Acceso concedido para guardiÃ¡n. Redirigiendo...');
          window.location.href = '/portal-pacto-azul.html?codigo=' + encodeURIComponent(cod);
          return;
        }
        
        alert('âŒ CÃ³digo no encontrado');
        return;
      }

      if (data.usado === true) {
        alert('âš ï¸ Este cÃ³digo ya fue utilizado');
        return;
      }

      await supabase
        .from('codigos')
        .update({ usado: true })
        .eq('id', data.id);

      alert('âœ… CÃ³digo vÃ¡lido. Accediendo al Portal...');
      window.location.href = '/portal-pacto-azul.html?codigo=' + encodeURIComponent(cod);
    }
    
    // Auto-cargar cÃ³digo de URL si existe
    document.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const codigoURL = urlParams.get('codigo');
      
      if (codigoURL) {
        inputCodigo.value = decodeURIComponent(codigoURL);
        setTimeout(() => {
          validarCodigo();
        }, 800);
      }
    });
  </script>
</body>
</html>
