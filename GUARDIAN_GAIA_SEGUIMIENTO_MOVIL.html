<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAIA NEXUS V4 - Sistema de Seguimiento Guardi√°n</title>
    
    <!-- SOLO PART√çCULAS (Three.js ELIMINADO) -->
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    
    <style>
        /* =========================================== */
        /* PALETA DE CONCIENCIA SAGRADA - GAIA NEXUS V4 */
        /* =========================================== */
        :root {
            /* C√ìSMICO */
            --deep-space: #0a0a16;
            --nebula-purple: #5d2fdf;
            --stardust-blue: #00e0ff;
            --planet-green: #2afc5b;
            --quantum-gold: #ffd700;
            --nova-red: #ff3366;
            --dark-matter: rgba(10, 10, 22, 0.95);
            
            /* CONCIENCIA SAGRADA */
            --conciencia-alta: #00ffaa;
            --conciencia-media: #ffaa00;
            --conciencia-baja: #ff5555;
            
            /* CHAKRAS PLANETARIOS */
            --chakra-raiz: #ff0000;
            --chakra-sacro: #ff5500;
            --chakra-plexo: #ffff00;
            --chakra-corazon: #00ff00;
            --chakra-garganta: #00ffff;
            --chakra-tercer-ojo: #5500ff;
            --chakra-corona: #aa00ff;
            
            /* ODS COLORES OFICIALES */
            --ods-1: #e5243b;   --ods-2: #dda63a;   --ods-3: #4c9f38;
            --ods-4: #c5192d;   --ods-5: #ff3a21;   --ods-6: #26bde2;
            --ods-7: #fcc30b;   --ods-8: #a21942;   --ods-9: #fd6925;
            --ods-10: #dd1367;  --ods-11: #fd9d24;  --ods-12: #bf8b2e;
            --ods-13: #3f7e44;  --ods-14: #0a97d9;  --ods-15: #56c02b;
            --ods-16: #00689d;  --ods-17: #19486a;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: var(--deep-space);
            color: white;
            font-family: 'Segoe UI', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        /* FONDO DE PART√çCULAS GAL√ÅCTICAS */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        /* =========================================== */
        /* DISE√ëO PRINCIPAL - M√ìVIL FIRST */
        /* =========================================== */
        .contenedor-movil {
            display: flex;
            flex-direction: column;
            padding: 15px;
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* CABECERA M√ìVIL */
        .header-movil {
            background: linear-gradient(90deg, 
                rgba(93, 47, 223, 0.2), 
                rgba(0, 224, 255, 0.2));
            border: 1px solid var(--stardust-blue);
            border-radius: 15px;
            padding: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(0, 224, 255, 0.2);
            animation: pulso-sagrado 7.83s infinite;
        }
        
        @keyframes pulso-sagrado {
            0%, 100% { 
                border-color: var(--stardust-blue);
                box-shadow: 0 0 20px rgba(0, 224, 255, 0.2);
            }
            50% { 
                border-color: var(--chakra-corazon);
                box-shadow: 0 0 30px rgba(0, 255, 170, 0.3);
            }
        }
        
        .titulo-movil h1 {
            font-size: 1.5rem;
            background: linear-gradient(90deg, #fff, var(--stardust-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 5px;
        }
        
        .subtitulo-movil {
            font-size: 0.8rem;
            color: var(--conciencia-media);
            text-align: center;
        }
        
        /* BR√öJULA M√ìVIL */
        .brujula-movil {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .instrumento-movil {
            text-align: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .instrumento-movil .valor {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--quantum-gold);
            margin: 5px 0;
        }
        
        .instrumento-movil .label {
            font-size: 0.7rem;
            color: #aaa;
        }
        
        /* =========================================== */
        /* TR√çADA GAIA - CENTRO DEL DISE√ëO */
        /* =========================================== */
        .triada-contenedor {
            background: rgba(10, 10, 22, 0.9);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(0, 224, 255, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .triada-titulo {
            color: var(--conciencia-alta);
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }
        
        .triada-item {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 12px;
            transition: transform 0.3s;
        }
        
        .triada-item:active {
            transform: translateY(-3px);
        }
        
        .triada-oceano {
            background: linear-gradient(135deg, 
                rgba(10, 151, 217, 0.2), 
                rgba(10, 151, 217, 0.3));
            border: 1px solid var(--ods-14);
        }
        
        .triada-aire {
            background: linear-gradient(135deg, 
                rgba(63, 126, 68, 0.2), 
                rgba(63, 126, 68, 0.3));
            border: 1px solid var(--ods-13);
        }
        
        .triada-hielo {
            background: linear-gradient(135deg, 
                rgba(0, 104, 157, 0.2), 
                rgba(0, 104, 157, 0.3));
            border: 1px solid var(--ods-16);
        }
        
        .triada-icono {
            font-size: 2rem;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .triada-titulo-item {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1rem;
            text-align: center;
        }
        
        .triada-valor {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 10px 0;
            text-align: center;
        }
        
        .triada-tendencia {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .tendencia-positiva { color: var(--planet-green); }
        .tendencia-negativa { color: var(--nova-red); }
        
        .triada-link {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            font-size: 0.8rem;
            color: var(--stardust-blue);
        }
        
        /* =========================================== */
        /* √ÅRBOL DE H√ÅBITOS - EXPANDIDO */
        /* =========================================== */
        .panel-habitos {
            background: var(--dark-matter);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(42, 252, 91, 0.3);
        }
        
        .titulo-habitos {
            color: var(--chakra-corazon);
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2rem;
        }
        
        /* FILTROS M√ìVIL */
        .filtros-movil {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
            -webkit-overflow-scrolling: touch;
        }
        
        .filtro-btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            border-radius: 20px;
            font-size: 0.8rem;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .filtro-btn.activo {
            background: var(--stardust-blue);
            color: black;
        }
        
        /* NODO DE H√ÅBITO M√ìVIL */
        .habito-nodo-movil {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--planet-green);
            position: relative;
            overflow: hidden;
        }
        
        .habito-nodo-movil::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                transparent 30%, 
                rgba(42, 252, 91, 0.05) 50%, 
                transparent 70%);
            transform: translateX(-100%);
        }
        
        .habito-nodo-movil:active::before {
            animation: brillo-habito 1.5s ease;
        }
        
        @keyframes brillo-habito {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .habito-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .habito-conciencia {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .punto-conciencia {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .habito-nombre {
            font-weight: bold;
            color: white;
            font-size: 0.95rem;
        }
        
        .habito-impacto {
            color: var(--planet-green);
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .habito-descripcion {
            font-size: 0.85rem;
            color: #aaa;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        .ods-mini {
            display: flex;
            gap: 5px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .ods-mini-item {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 0.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .habito-mantra {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-style: italic;
            font-size: 0.85rem;
            color: var(--conciencia-alta);
            text-align: center;
        }
        
        .habito-footer {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-top: 10px;
        }
        
        .habito-adopcion {
            color: var(--conciencia-media);
        }
        
        .btn-registrar {
            padding: 6px 12px;
            background: var(--chakra-corazon);
            border: none;
            color: black;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        /* =========================================== */
        /* REGISTRO DIARIO */
        /* =========================================== */
        .registro-diario {
            background: linear-gradient(135deg, 
                rgba(0,255,170,0.1), 
                rgba(85,0,255,0.1));
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--chakra-tercer-ojo);
        }
        
        .registro-titulo {
            color: var(--chakra-tercer-ojo);
            margin-bottom: 10px;
            text-align: center;
            font-size: 1rem;
        }
        
        .registro-texto {
            color: #ccc;
            font-size: 0.85rem;
            margin-bottom: 15px;
            text-align: center;
            line-height: 1.4;
        }
        
        .btn-registro-principal {
            background: var(--chakra-corazon);
            border: none;
            color: black;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            width: 100%;
            font-size: 0.9rem;
        }
        
        /* =========================================== */
        /* CHAKRAS M√ìVIL */
        /* =========================================== */
        .chakras-movil {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            -webkit-overflow-scrolling: touch;
            margin-top: 20px;
        }
        
        .chakra-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.5);
            min-width: 80px;
            flex-shrink: 0;
        }
        
        .chakra-item.activo {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .chakra-icono {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .chakra-nombre {
            font-size: 0.7rem;
            text-align: center;
            color: #aaa;
            line-height: 1.2;
        }
        
        /* =========================================== */
        /* MODAL M√ìVIL */
        /* =========================================== */
        .modal-movil {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: aparecer-modal 0.3s ease;
        }
        
        @keyframes aparecer-modal {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-contenido {
            background: var(--dark-matter);
            border-radius: 20px;
            padding: 25px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--stardust-blue);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }
        
        /* =========================================== */
        /* RESPONSIVE PARA TABLET */
        /* =========================================== */
        @media (min-width: 768px) {
            .contenedor-movil {
                padding: 25px;
                gap: 25px;
            }
            
            .header-movil {
                padding: 20px;
            }
            
            .titulo-movil h1 {
                font-size: 1.8rem;
            }
            
            .brujula-movil {
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
            }
            
            .triada-contenedor {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
                padding: 25px;
            }
            
            .triada-item {
                margin-bottom: 0;
                height: 100%;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
            }
            
            .filtros-movil {
                justify-content: center;
            }
            
            .arbol-habitos-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .habito-nodo-movil {
                margin-bottom: 0;
                height: 100%;
                display: flex;
                flex-direction: column;
            }
        }
        
        /* =========================================== */
        /* ANIMACIONES Y EFECTOS */
        /* =========================================== */
        .aura-efecto {
            position: fixed;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0.2;
            pointer-events: none;
            z-index: -1;
        }
        
        .particula-sagrada {
            position: fixed;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <!-- AURAS DE FONDO -->
    <div class="aura-efecto aura-raiz" style="top: 10%; left: 10%; background: var(--chakra-raiz);"></div>
    <div class="aura-efecto aura-corazon" style="top: 60%; right: 15%; background: var(--chakra-corazon);"></div>
    
    <!-- FONDO DE PART√çCULAS -->
    <div id="particles-js"></div>
    
    <!-- CONTENEDOR PRINCIPAL M√ìVIL -->
    <div class="contenedor-movil">
        
        <!-- CABECERA -->
        <header class="header-movil">
            <div class="titulo-movil">
                <h1>üåç GUARDI√ÅN GAIA</h1>
                <div class="subtitulo-movil">Sistema de Seguimiento Personal</div>
            </div>
            
            <div class="brujula-movil">
                <div class="instrumento-movil">
                    <div class="valor" id="conciencia-personal">78.4%</div>
                    <div class="label">Tu Conciencia</div>
                </div>
                <div class="instrumento-movil">
                    <div class="valor" id="habitos-activos">12</div>
                    <div class="label">H√°bitos Activos</div>
                </div>
                <div class="instrumento-movil">
                    <div class="valor" id="impacto-total">142.6</div>
                    <div class="label">kg CO‚ÇÇ Evitados</div>
                </div>
                <div class="instrumento-movil">
                    <div class="valor" id="racha-actual">7</div>
                    <div class="label">D√≠as de Racha</div>
                </div>
            </div>
        </header>
        
        <!-- TR√çADA GAIA - CENTRO DEL DISE√ëO -->
        <div class="triada-contenedor">
            <div class="triada-titulo">üåä‚ùÑÔ∏èüå¨Ô∏è TR√çADA GAIA</div>
            
            <div class="triada-item triada-oceano">
                <div class="triada-icono">üåä</div>
                <div class="triada-titulo-item">OC√âANO</div>
                <div class="triada-valor" id="temperatura-oceano">+0.8¬∞C</div>
                <div class="triada-tendencia tendencia-negativa">
                    <span>‚ñ≤</span> Anomal√≠a t√©rmica
                </div>
                <div class="triada-link" onclick="mostrarDetallesOceano()">
                    <span>Ver datos</span>
                    <span>‚Üí</span>
                </div>
            </div>
            
            <div class="triada-item triada-aire">
                <div class="triada-icono">üå¨Ô∏è</div>
                <div class="triada-titulo-item">AIRE</div>
                <div class="triada-valor" id="co2-concentracion">415 ppm</div>
                <div class="triada-tendencia tendencia-negativa">
                    <span>‚ñ≤</span> +2.5 ppm/a√±o
                </div>
                <div class="triada-link" onclick="mostrarDetallesAire()">
                    <span>Ver datos</span>
                    <span>‚Üí</span>
                </div>
            </div>
            
            <div class="triada-item triada-hielo">
                <div class="triada-icono">‚ùÑÔ∏è</div>
                <div class="triada-titulo-item">HIELO</div>
                <div class="triada-valor" id="perdida-hielo">-7.8%</div>
                <div class="triada-tendencia tendencia-negativa">
                    <span>‚ñº</span> P√©rdida anual
                </div>
                <div class="triada-link" onclick="mostrarDetallesHielo()">
                    <span>Ver datos</span>
                    <span>‚Üí</span>
                </div>
            </div>
        </div>
        
        <!-- √ÅRBOL DE H√ÅBITOS -->
        <div class="panel-habitos">
            <div class="titulo-habitos">üåø MIS 18 H√ÅBITOS REGENERATIVOS</div>
            
            <!-- FILTROS -->
            <div class="filtros-movil">
                <button class="filtro-btn activo" onclick="filtrarHabitos('todos')">üåç Todos</button>
                <button class="filtro-btn" onclick="filtrarHabitos('alta')">üíé Alta Conciencia</button>
                <button class="filtro-btn" onclick="filtrarHabitos('media')">‚ö° Media Conciencia</button>
                <button class="filtro-btn" onclick="filtrarHabitos('ods')">üéØ Por ODS</button>
            </div>
            
            <!-- LISTA DE H√ÅBITOS -->
            <div class="arbol-habitos-grid" id="arbol-habitos">
                <!-- Cargado din√°micamente -->
            </div>
            
            <!-- REGISTRO DIARIO -->
            <div class="registro-diario">
                <div class="registro-titulo">üìä REGISTRO DE IMPACTO DIARIO</div>
                <div class="registro-texto">
                    "Cada h√°bito registrado es un latido en la red planetaria."
                </div>
                <button class="btn-registro-principal" onclick="abrirRegistroDiario()">
                    üìù REGISTRAR MI IMPACTO HOY
                </button>
            </div>
        </div>
        
        <!-- CHAKRAS PLANETARIOS -->
        <div class="chakras-movil">
            <div class="chakra-item chakra-raiz activo" onclick="activarChakra('raiz')">
                <div class="chakra-icono">üî¥</div>
                <div class="chakra-nombre">RA√çZ<br>Monte Shasta</div>
            </div>
            <div class="chakra-item chakra-sacro" onclick="activarChakra('sacro')">
                <div class="chakra-icono">üü†</div>
                <div class="chakra-nombre">SACRO<br>Amazonas</div>
            </div>
            <div class="chakra-item chakra-plexo" onclick="activarChakra('plexo')">
                <div class="chakra-icono">üü°</div>
                <div class="chakra-nombre">PLEXO<br>Himalaya</div>
            </div>
            <div class="chakra-item chakra-corazon" onclick="activarChakra('corazon')">
                <div class="chakra-icono">üíö</div>
                <div class="chakra-nombre">CORAZ√ìN<br>Cataratas Victoria</div>
            </div>
            <div class="chakra-item chakra-garganta" onclick="activarChakra('garganta')">
                <div class="chakra-icono">üîµ</div>
                <div class="chakra-nombre">GARGANTA<br>Monte Fuji</div>
            </div>
            <div class="chakra-item chakra-tercer-ojo" onclick="activarChakra('tercer-ojo')">
                <div class="chakra-icono">üü£</div>
                <div class="chakra-nombre">TERCER OJO<br>Machu Picchu</div>
            </div>
            <div class="chakra-item chakra-corona" onclick="activarChakra('corona')">
                <div class="chakra-icono">üëë</div>
                <div class="chakra-nombre">CORONA<br>Monte Everest</div>
            </div>
        </div>
    </div>

    <!-- SUPABASE CLIENT (SOLO PARA H√ÅBITOS) -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <script>
        // ===========================================
        // INICIALIZACI√ìN SIMPLIFICADA
        // ===========================================
        
        function inicializarParticulas() {
            particlesJS('particles-js', {
                particles: {
                    number: { value: 150, density: { enable: true, value_area: 800 } },
                    color: { value: ['#00ffaa', '#00a8ff', '#ffaa00'] },
                    opacity: { value: 0.5, random: true },
                    size: { value: 3, random: true },
                    line_linked: {
                        enable: true,
                        distance: 120,
                        color: '#00e0ff',
                        opacity: 0.2,
                        width: 1
                    },
                    move: {
                        enable: true,
                        speed: 0.8,
                        direction: "none",
                        random: true
                    }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: { enable: true, mode: "repulse" },
                        onclick: { enable: true, mode: "push" }
                    }
                }
            });
        }
        
        // ===========================================
        // DATOS DE H√ÅBITOS (SIMPLIFICADO)
        // ===========================================
        
        const habitosSagrados = [
            { 
                id: 1, 
                nombre: "ü•§ Reducir pl√°sticos", 
                impacto: 0.3, 
                adopcion: 65,
                descripcion: "Cada pl√°stico evitado ayuda a los oc√©anos",
                conciencia: "media",
                ods: [14, 12, 6],
                mantra: "Mi consumo honra la pureza de Gaia"
            },
            { 
                id: 2, 
                nombre: "üö≤ Transporte activo", 
                impacto: 2.5, 
                adopcion: 45,
                descripcion: "Moverse sin contaminar",
                conciencia: "alta",
                ods: [11, 13, 3],
                mantra: "Me muevo en armon√≠a"
            },
            { 
                id: 3, 
                nombre: "üíß Consumo de agua", 
                impacto: 0.1, 
                adopcion: 72,
                descripcion: "Consciencia en cada gota",
                conciencia: "alta",
                ods: [6, 14, 15],
                mantra: "Honro el agua con presencia"
            },
            { 
                id: 4, 
                nombre: "üå± Compras conscientes", 
                impacto: 1.2, 
                adopcion: 58,
                descripcion: "Cada compra es un voto",
                conciencia: "media",
                ods: [12, 8, 10],
                mantra: "Mi dinero siembra el futuro"
            },
            { 
                id: 5, 
                nombre: "‚ôªÔ∏è Reciclaje", 
                impacto: 0.4, 
                adopcion: 68,
                descripcion: "Transformar lo descartado",
                conciencia: "media",
                ods: [12, 9, 11],
                mantra: "Nada se pierde"
            },
            { 
                id: 6, 
                nombre: "üìµ Silencio digital", 
                impacto: 0.05, 
                adopcion: 35,
                descripcion: "Espacios sin conexi√≥n",
                conciencia: "alta",
                ods: [3, 11, 13],
                mantra: "Desconecto para reconectar"
            },
            { 
                id: 7, 
                nombre: "üçÉ Alimentaci√≥n", 
                impacto: 1.8, 
                adopcion: 42,
                descripcion: "Comer con conciencia",
                conciencia: "alta",
                ods: [2, 3, 12],
                mantra: "Este alimento es vida"
            },
            { 
                id: 8, 
                nombre: "üîã Ahorro energ√≠a", 
                impacto: 1.5, 
                adopcion: 55,
                descripcion: "Consciencia en cada vatio",
                conciencia: "media",
                ods: [7, 13, 11],
                mantra: "La energ√≠a fluye"
            },
            { 
                id: 9, 
                nombre: "üèñÔ∏è Limpieza natural", 
                impacto: 3.0, 
                adopcion: 28,
                descripcion: "Cuidar espacios naturales",
                conciencia: "alta",
                ods: [14, 15, 11],
                mantra: "Devuelvo la pureza"
            }
        ];
        
        // ===========================================
        // FUNCIONES PRINCIPALES
        // ===========================================
        
        function filtrarHabitos(filtro) {
            const contenedor = document.getElementById('arbol-habitos');
            if (!contenedor) return;
            
            let habitosFiltrados = [];
            
            if (filtro === 'todos') {
                habitosFiltrados = habitosSagrados;
            } else if (filtro === 'alta') {
                habitosFiltrados = habitosSagrados.filter(h => h.conciencia === 'alta');
            } else if (filtro === 'media') {
                habitosFiltrados = habitosSagrados.filter(h => h.conciencia === 'media');
            } else if (filtro === 'ods') {
                mostrarSelectorODS();
                return;
            }
            
            mostrarHabitos(habitosFiltrados);
        }
        
        function mostrarSelectorODS() {
            const contenedor = document.getElementById('arbol-habitos');
            contenedor.innerHTML = '';
            
            const selector = document.createElement('div');
            selector.style.cssText = `
                background: rgba(0,0,0,0.3);
                padding: 20px;
                border-radius: 15px;
                margin-bottom: 20px;
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            `;
            
            for (let i = 1; i <= 17; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.style.cssText = `
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    background: var(--ods-${i});
                    border: none;
                    color: white;
                    font-weight: bold;
                    font-size: 0.9rem;
                `;
                btn.onclick = () => filtrarPorODS(i);
                selector.appendChild(btn);
            }
            
            contenedor.appendChild(selector);
        }
        
        function filtrarPorODS(odsNumero) {
            const habitosFiltrados = habitosSagrados.filter(h => h.ods.includes(odsNumero));
            mostrarHabitos(habitosFiltrados, odsNumero);
        }
        
        function mostrarHabitos(habitos, odsFiltro = null) {
            const contenedor = document.getElementById('arbol-habitos');
            contenedor.innerHTML = '';
            
            if (odsFiltro) {
                const titulo = document.createElement('div');
                titulo.style.cssText = `
                    color: var(--ods-${odsFiltro});
                    font-weight: bold;
                    margin-bottom: 15px;
                    text-align: center;
                    font-size: 1rem;
                    grid-column: 1 / -1;
                `;
                titulo.textContent = `üéØ ODS ${odsFiltro}`;
                contenedor.appendChild(titulo);
            }
            
            habitos.forEach(habito => {
                const color = habito.conciencia === 'alta' ? 'var(--conciencia-alta)' : 
                             habito.conciencia === 'media' ? 'var(--conciencia-media)' : 'var(--conciencia-baja)';
                
                const div = document.createElement('div');
                div.className = 'habito-nodo-movil';
                div.innerHTML = `
                    <div class="habito-header">
                        <div class="habito-conciencia">
                            <div class="punto-conciencia" style="background: ${color};"></div>
                            <div class="habito-nombre">${habito.nombre}</div>
                        </div>
                        <div class="habito-impacto">${habito.impacto} kg</div>
                    </div>
                    
                    <div class="habito-descripcion">
                        ${habito.descripcion}
                    </div>
                    
                    <div class="ods-mini">
                        ${habito.ods.map(num => `
                            <div class="ods-mini-item" style="background: var(--ods-${num});">
                                ${num}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="habito-mantra">
                        "${habito.mantra}"
                    </div>
                    
                    <div class="habito-footer">
                        <div class="habito-adopcion">
                            Adopci√≥n: ${habito.adopcion}%
                        </div>
                        <button class="btn-registrar" onclick="registrarHabito(${habito.id})">
                            üìù Registrar
                        </button>
                    </div>
                `;
                
                contenedor.appendChild(div);
            });
        }
        
        function registrarHabito(habitoId) {
            abrirRegistroDiario();
            setTimeout(() => {
                const select = document.getElementById('select-habito');
                if (select) select.value = habitoId;
            }, 100);
        }
        
        function activarChakra(nombreChakra) {
            document.querySelectorAll('.chakra-item').forEach(chakra => {
                chakra.classList.remove('activo');
            });
            
            const chakraElement = document.querySelector(`.chakra-${nombreChakra.replace('-', '')}`);
            if (chakraElement) {
                chakraElement.classList.add('activo');
                crearParticula(
                    chakraElement.getBoundingClientRect().left + chakraElement.offsetWidth / 2,
                    chakraElement.getBoundingClientRect().top + chakraElement.offsetHeight / 2,
                    getChakraColor(nombreChakra)
                );
            }
        }
        
        function getChakraColor(nombre) {
            const colores = {
                'raiz': '#ff0000',
                'sacro': '#ff5500',
                'plexo': '#ffff00',
                'corazon': '#00ff00',
                'garganta': '#00ffff',
                'tercer-ojo': '#5500ff',
                'corona': '#aa00ff'
            };
            return colores[nombre] || '#ffffff';
        }
        
        function crearParticula(x, y, color) {
            const particula = document.createElement('div');
            particula.className = 'particula-sagrada';
            particula.style.cssText = `
                position: fixed;
                left: ${x}px;
                top: ${y}px;
                background: ${color};
                width: 4px;
                height: 4px;
                border-radius: 50%;
                z-index: 9999;
            `;
            
            document.body.appendChild(particula);
            
            const angulo = Math.random() * Math.PI * 2;
            const distancia = 50 + Math.random() * 100;
            const destinoX = Math.cos(angulo) * distancia;
            const destinoY = Math.sin(angulo) * distancia;
            
            const animacion = particula.animate([
                { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                { transform: `translate(${destinoX}px, ${destinoY}px) scale(0)`, opacity: 0 }
            ], {
                duration: 1000,
                easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
            });
            
            animacion.onfinish = () => particula.remove();
        }
        
        // ===========================================
        // TR√çADA GAIA
        // ===========================================
        
        function actualizarTriadaGaia() {
            document.getElementById('temperatura-oceano').textContent = 
                `+${(0.8 + (Math.random() * 0.2 - 0.1)).toFixed(1)}¬∞C`;
            
            document.getElementById('co2-concentracion').textContent = 
                `${(415 + Math.random() * 2).toFixed(0)} ppm`;
            
            document.getElementById('perdida-hielo').textContent = 
                `${(-7.8 + (Math.random() * 2 - 1)).toFixed(1)}%`;
        }
        
        function mostrarDetallesOceano() {
            abrirModal(`
                <h2 style="color: var(--ods-14); margin-bottom: 15px;">üåä DATOS DEL OC√âANO</h2>
                <div style="background: rgba(10,151,217,0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <div style="margin-bottom: 10px;">
                        <div style="color: #aaa; font-size: 0.9rem;">Temperatura</div>
                        <div style="color: white; font-size: 1.2rem;">+0.8¬∞C</div>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <div style="color: #aaa; font-size: 0.9rem;">Acidificaci√≥n</div>
                        <div style="color: white; font-size: 1.2rem;">pH 8.1</div>
                    </div>
                    <div>
                        <div style="color: #aaa; font-size: 0.9rem;">Nivel del Mar</div>
                        <div style="color: white; font-size: 1.2rem;">+3.4 mm/a√±o</div>
                    </div>
                </div>
                <p style="color: #aaa; font-size: 0.9rem;">
                    Datos simulados de NASA OceanColor. En producci√≥n se conectar√≠a a API real.
                </p>
            `);
        }
        
        function mostrarDetallesAire() {
            abrirModal(`
                <h2 style="color: var(--ods-13); margin-bottom: 15px;">üå¨Ô∏è CALIDAD DEL AIRE</h2>
                <div style="background: rgba(63,126,68,0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <div style="margin-bottom: 10px;">
                        <div style="color: #aaa; font-size: 0.9rem;">CO‚ÇÇ</div>
                        <div style="color: white; font-size: 1.2rem;">415 ppm</div>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <div style="color: #aaa; font-size: 0.9rem;">PM2.5</div>
                        <div style="color: white; font-size: 1.2rem;">15 ¬µg/m¬≥</div>
                    </div>
                    <div>
                        <div style="color: #aaa; font-size: 0.9rem;">Calidad</div>
                        <div style="color: var(--planet-green); font-size: 1.2rem;">Moderada</div>
                    </div>
                </div>
                <p style="color: #aaa; font-size: 0.9rem;">
                    Datos simulados de OpenAQ. En producci√≥n se conectar√≠a a API real.
                </p>
            `);
        }
        
        function mostrarDetallesHielo() {
            abrirModal(`
                <h2 style="color: var(--ods-16); margin-bottom: 15px;">‚ùÑÔ∏è P√âRDIDA DE HIELO</h2>
                <div style="background: rgba(0,104,157,0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <div style="margin-bottom: 10px;">
                        <div style="color: #aaa; font-size: 0.9rem;">Groenlandia</div>
                        <div style="color: var(--nova-red); font-size: 1.2rem;">-267 Gt/a√±o</div>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <div style="color: #aaa; font-size: 0.9rem;">Ant√°rtida</div>
                        <div style="color: var(--nova-red); font-size: 1.2rem;">-127 Gt/a√±o</div>
                    </div>
                    <div>
                        <div style="color: #aaa; font-size: 0.9rem;">√Årtico</div>
                        <div style="color: var(--nova-red); font-size: 1.2rem;">-13% por d√©cada</div>
                    </div>
                </div>
                <p style="color: #aaa; font-size: 0.9rem;">
                    Datos simulados de NASA IceSat-2. En producci√≥n se conectar√≠a a API real.
                </p>
            `);
        }
        
        function abrirModal(contenidoHTML) {
            const modal = document.createElement('div');
            modal.className = 'modal-movil';
            modal.innerHTML = `
                <div class="modal-contenido">
                    ${contenidoHTML}
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="cerrarModal()" style="padding: 10px 20px; background: var(--stardust-blue); border: none; color: black; border-radius: 20px; font-weight: bold;">
                            CERRAR
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    cerrarModal();
                }
            });
        }
        
        function cerrarModal() {
            const modal = document.querySelector('.modal-movil');
            if (modal) {
                modal.style.animation = 'aparecer-modal 0.3s ease reverse';
                setTimeout(() => modal.remove(), 300);
            }
        }
        
        // ===========================================
        // REGISTRO DIARIO
        // ===========================================
        
        function abrirRegistroDiario() {
            abrirModal(`
                <h2 style="color: var(--conciencia-alta); margin-bottom: 15px;">üìä REGISTRO DE IMPACTO</h2>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; color: var(--chakra-corazon);">H√°bito:</label>
                    <select id="select-habito" style="width: 100%; padding: 10px; border-radius: 10px; background: rgba(255,255,255,0.1); border: 1px solid #444; color: white;">
                        <option value="">Selecciona</option>
                        ${habitosSagrados.map(h => `<option value="${h.id}">${h.nombre}</option>`).join('')}
                    </select>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; color: var(--chakra-corazon);">Impacto (kg CO‚ÇÇ):</label>
                    <input type="number" id="input-impacto" min="0" max="100" step="0.1" value="0.5" style="width: 100%; padding: 10px; border-radius: 10px; background: rgba(255,255,255,0.1); border: 1px solid #444; color: white;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; color: var(--chakra-corazon);">Nivel de conciencia:</label>
                    <div style="display: flex; gap: 5px; margin-bottom: 10px;">
                        <button class="filtro-btn" onclick="seleccionarConciencia(1)" style="flex: 1;">üò¥ 1</button>
                        <button class="filtro-btn" onclick="seleccionarConciencia(2)" style="flex: 1;">üòê 2</button>
                        <button class="filtro-btn" onclick="seleccionarConciencia(3)" style="flex: 1;">üôÇ 3</button>
                        <button class="filtro-btn" onclick="seleccionarConciencia(4)" style="flex: 1;">üòä 4</button>
                        <button class="filtro-btn" onclick="seleccionarConciencia(5)" style="flex: 1;">üòá 5</button>
                    </div>
                    <input type="hidden" id="input-conciencia" value="3">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 5px; color: var(--chakra-corazon);">Notas:</label>
                    <textarea id="input-notas" rows="3" placeholder="¬øC√≥mo te sentiste? ¬øQu√© aprendiste?" style="width: 100%; padding: 10px; border-radius: 10px; background: rgba(255,255,255,0.1); border: 1px solid #444; color: white; resize: none;"></textarea>
                </div>
                
                <button onclick="guardarRegistro()" style="width: 100%; padding: 12px; background: linear-gradient(90deg, var(--chakra-corazon), var(--chakra-corona)); border: none; color: black; border-radius: 25px; font-weight: bold; margin-bottom: 10px;">
                    üíæ GUARDAR REGISTRO
                </button>
            `);
        }
        
        function seleccionarConciencia(nivel) {
            const botones = document.querySelectorAll('.filtro-btn');
            botones.forEach((btn, index) => {
                if (index < 5) {
                    btn.style.background = index === nivel - 1 ? 'var(--chakra-corazon)' : 'rgba(255,255,255,0.1)';
                    btn.style.color = index === nivel - 1 ? 'black' : 'white';
                }
            });
            document.getElementById('input-conciencia').value = nivel;
        }
        
        function guardarRegistro() {
            const habitoId = document.getElementById('select-habito').value;
            const impacto = parseFloat(document.getElementById('input-impacto').value);
            
            if (!habitoId) {
                alert("Selecciona un h√°bito");
                return;
            }
            
            // Guardar en localStorage
            const registros = JSON.parse(localStorage.getItem('gaiaRegistros') || '[]');
            registros.push({
                habitoId: habitoId,
                impacto: impacto,
                fecha: new Date().toISOString(),
                conciencia: document.getElementById('input-conciencia').value,
                notas: document.getElementById('input-notas').value
            });
            localStorage.setItem('gaiaRegistros', JSON.stringify(registros));
            
            // Actualizar m√©tricas
            const totalImpacto = registros.reduce((sum, r) => sum + (r.impacto || 0), 0);
            document.getElementById('impacto-total').textContent = totalImpacto.toFixed(1);
            
            const diasConsecutivos = calcularRacha(registros);
            document.getElementById('racha-actual').textContent = diasConsecutivos;
            
            document.getElementById('habitos-activos').textContent = 
                new Set(registros.map(r => r.habitoId)).size;
            
            alert(`‚úÖ Registro guardado\nImpacto: ${impacto} kg CO‚ÇÇ evitados`);
            cerrarModal();
        }
        
        function calcularRacha(registros) {
            if (registros.length === 0) return 0;
            
            let racha = 1;
            const hoy = new Date();
            hoy.setHours(0,0,0,0);
            
            // Ordenar por fecha descendente
            registros.sort((a,b) => new Date(b.fecha) - new Date(a.fecha));
            
            for (let i = 1; i < registros.length; i++) {
                const fechaActual = new Date(registros[i-1].fecha);
                const fechaAnterior = new Date(registros[i].fecha);
                
                fechaActual.setHours(0,0,0,0);
                fechaAnterior.setHours(0,0,0,0);
                
                const diferenciaDias = (fechaActual - fechaAnterior) / (1000 * 60 * 60 * 24);
                
                if (diferenciaDias === 1) {
                    racha++;
                } else {
                    break;
                }
            }
            
            // Verificar si el √∫ltimo registro es de hoy
            const ultimoRegistro = new Date(registros[0].fecha);
            ultimoRegistro.setHours(0,0,0,0);
            
            if (ultimoRegistro.getTime() !== hoy.getTime()) {
                racha = 0;
            }
            
            return racha;
        }
        
        // ===========================================
        // INICIALIZACI√ìN
        // ===========================================
        
        window.onload = function() {
            console.log("üåç GUARDI√ÅN GAIA - INICIANDO");
            
            // 1. Part√≠culas
            inicializarParticulas();
            
            // 2. Cargar h√°bitos
            filtrarHabitos('todos');
            
            // 3. Cargar m√©tricas de localStorage
            const registros = JSON.parse(localStorage.getItem('gaiaRegistros') || '[]');
            const totalImpacto = registros.reduce((sum, r) => sum + (r.impacto || 0), 0);
            document.getElementById('impacto-total').textContent = totalImpacto.toFixed(1);
            
            const diasConsecutivos = calcularRacha(registros);
            document.getElementById('racha-actual').textContent = diasConsecutivos;
            
            document.getElementById('habitos-activos').textContent = 
                new Set(registros.map(r => r.habitoId)).size;
            
            // 4. Actualizaciones peri√≥dicas
            setInterval(() => {
                // Incrementar conciencia gradualmente
                const elemento = document.getElementById('conciencia-personal');
                let valor = parseFloat(elemento.textContent);
                valor += Math.random() * 0.02;
                if (valor > 100) valor = 100;
                elemento.textContent = valor.toFixed(1) + '%';
            }, 10000);
            
            // Actualizar inmediatamente
            actualizarPentagramaReal();
            console.log("‚úÖ GUARDI√ÅN GAIA - LISTO");
        };
        
        // ===========================================
        // SUPABASE (OPCIONAL - MANTENIDO)
        // ===========================================
        const SUPABASE_URL = 'https://ophicpcbgdgzthjamzoz.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9waGljcGNiZ2RnenRoamFtem96Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3MjgwMzUsImV4cCI6MjA4MDMwNDAzNX0.K55Tk-cdbAFDOtGrIMN7vYFaJAccrsD6UdOrARt1P5c';
        
        const gaiaSupabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
     // --- SISTEMA PENTAGRAMA GAIA (NASA REAL-TIME) ---
async function actualizarPentagramaReal() {
    try {
        const { data: metricas, error } = await gaiaSupabase
            .from('gaia_pentagram_metrics')
            .select('*')
            .order('id', { ascending: true });

        if (error) throw error;

        const contenedor = document.querySelector('.triada-contenedor');
        if (!contenedor) return;

        contenedor.innerHTML = '<div class="triada-titulo">üåç PENTAGRAMA GAIA (ESTADO GLOBAL REAL)</div>';

        metricas.forEach(m => {
            const item = document.createElement('div');
            item.className = 'triada-item triada-' + m.slug; 
            item.innerHTML = `
                <div class="triada-titulo-item">${m.label.toUpperCase()}</div>
                <div class="triada-valor">${m.valor_actual} <span style="font-size: 0.7rem">${m.unidad}</span></div>
                <div class="triada-tendencia ${m.tendencia === 'ascendente' ? 'tendencia-negativa' : 'tendencia-positiva'}">
                    <span>${m.tendencia === 'ascendente' ? '‚ñ≤' : '‚ñº'}</span> ${m.tendencia}
                </div>
            `;
            contenedor.appendChild(item);
        });
    } catch (err) {
        console.warn("‚ö†Ô∏è Telemetr√≠a de Gaia no disponible:", err.message);
    }
}
  async function actualizarPentagramaReal() {
    try {
        const { data: metricas, error } = await gaiaSupabase
            .from('gaia_pentagram_metrics')
            .select('*')
            .order('id', { ascending: true });

        if (error) throw error;

        const contenedor = document.querySelector('.triada-contenedor');
        contenedor.innerHTML = '<div class="triada-titulo">üåç PENTAGRAMA GAIA (ESTADO GLOBAL REAL)</div>';

        metricas.forEach(m => {
            const item = document.createElement('div');
            item.className = `triada-item triada-${m.slug}`; 
            item.innerHTML = `
                <div class="triada-titulo-item">${m.label.toUpperCase()}</div>
                <div class="triada-valor">${m.valor_actual} <span style="font-size: 0.7rem">${m.unidad}</span></div>
                <div class="triada-tendencia ${m.tendencia === 'ascendente' ? 'tendencia-negativa' : 'tendencia-positiva'}">
                    <span>${m.tendencia === 'ascendente' ? '‚ñ≤' : '‚ñº'}</span> ${m.tendencia}
                </div>
            `;
            contenedor.appendChild(item);
        });
    } catch (err) {
        console.warn("‚ö†Ô∏è Telemetr√≠a de Gaia no disponible:", err.message);
    }
}
async function actualizarPentagramaReal() {
    try {
        const { data: metricas, error } = await gaiaSupabase
            .from('gaia_pentagram_metrics')
            .select('*')
            .order('id', { ascending: true });

        if (error) throw error;

        const contenedor = document.querySelector('.triada-contenedor');
        contenedor.innerHTML = '<div class="triada-titulo">üåç PENTAGRAMA GAIA (ESTADO GLOBAL)</div>';

        metricas.forEach(m => {
            const item = document.createElement('div');
            item.className = `triada-item triada-${m.slug}`; 
            item.innerHTML = `
                <div class="triada-titulo-item">${m.label.toUpperCase()}</div>
                <div class="triada-valor">${m.valor_actual} <span style="font-size: 0.7rem">${m.unidad}</span></div>
                <div class="triada-tendencia ${m.tendencia === 'ascendente' ? 'tendencia-negativa' : 'tendencia-positiva'}">
                    <span>${m.tendencia === 'ascendente' ? '‚ñ≤' : '‚ñº'}</span> ${m.tendencia}
                </div>
            `;
            contenedor.appendChild(item);
        });
    } catch (err) {
        console.warn("‚ö†Ô∏è Telemetr√≠a de Gaia no disponible:", err.message);
    }
}
        // Funci√≥n opcional para sincronizar con Supabase
        async function sincronizarConSupabase() {
            try {
                const registros = JSON.parse(localStorage.getItem('gaiaRegistros') || '[]');
                
                for (const registro of registros) {
                    const { error } = await gaiaSupabase
                        .from('registros_diarios')
                        .insert([{
                            usuario_id: 'guardian-local',
                            habito_id: registro.habitoId,
                            impacto_co2: registro.impacto,
                            nivel_conciencia: registro.conciencia * 20,
                            notas: registro.notas,
                            fecha: registro.fecha
                        }]);
                    
                    if (error) console.warn("Error sincronizando:", error);
                }
                
                console.log("‚úÖ Sincronizaci√≥n completada");
            } catch (error) {
                console.warn("‚ö†Ô∏è Error conectando con Supabase");
            }
        }
        
        // Sincronizar cada 5 minutos si hay conexi√≥n
        if (navigator.onLine) {
            setInterval(sincronizarConSupabase, 300000);
        }
    </script>
</body>
</html>
