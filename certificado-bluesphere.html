<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificado de Lealtad Consciente ‚Äì BlueSphere</title>
    <style>
        /* PALETA INSPIRADA EN GHIBLI (Tonos suaves, terrosos, y naturales) */
        :root {
            --azul-cielo: #a0c4ff;
            --verde-musgo: #6a994e;
            --tierra-suave: #bc8f8f; 
            --papel-crema: #f7f3e8;
            --gris-texto: #333333;
            --sello-dorado: #e0ac42; 
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background-color: var(--papel-crema); 
            color: var(--gris-texto);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .certificado-container {
            background: #ffffff;
            width: 100%;
            max-width: 900px;
            min-height: 650px;
            border: 15px solid var(--tierra-suave); 
            border-radius: 25px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 40px;
            overflow: hidden;
            background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25'%3E%3Cdefs%3E%3Cpattern id='n' width='16' height='16' patternUnits='userSpaceOnUse'%3E%3Ccircle fill='none' stroke='%23dddddd' stroke-width='0.5' cx='8' cy='8' r='1'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23n)'/%3E%3C/svg%3E");
        }
        
        .certificado-container::before, .certificado-container::after {
            content: none;
        }
        
        .header-certificado {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .logo-space {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            background: none; 
            border-radius: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            box-shadow: none;
        }
        
        .logo-space::before {
            content: "üçÉ";
            font-size: 4rem;
            color: var(--verde-musgo);
        }
        
        .titulo-certificado {
            font-size: 3rem;
            color: var(--gris-texto);
            margin-bottom: 10px;
            font-weight: 500;
            text-transform: none;
            letter-spacing: 1px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05); 
        }
        
        .subtitulo-certificado {
            font-size: 1.4rem;
            color: var(--verde-musgo);
            font-style: italic;
            margin-bottom: 5px;
        }
        
        .numero-certificado {
            font-size: 1rem;
            color: white;
            background: var(--azul-cielo);
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
        }
        
        .cuerpo-certificado {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            z-index: 2;
        }
        
        .texto-compromiso {
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 30px;
            text-align: center;
            color: var(--gris-texto);
        }
        
        .compromisos-lista, .compromisos-avanzados {
            background: rgba(255, 255, 255, 0.7); 
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid var(--azul-cielo);
            margin: 25px 0;
            text-align: left;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .compromisos-lista h3, .compromisos-avanzados h3 {
            color: var(--verde-musgo);
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.5rem;
        }
        
        .compromiso-item:hover {
            background: rgba(160, 196, 255, 0.1);
        }
        
        .seccion-firma {
            margin: 40px 0;
            padding: 30px;
            background: rgba(245, 245, 245, 0.8);
            border-radius: 10px;
            border-top: 3px solid var(--tierra-suave);
        }
        
        .btn-firmar {
            background: linear-gradient(135deg, var(--verde-musgo), #5c7e46); 
            color: white;
        }
        
        .btn-descargar {
            background: linear-gradient(135deg, var(--azul-cielo), #7c9fdf);
            color: var(--gris-texto);
        }
        
        .sello {
            position: absolute;
            bottom: 40px;
            right: 40px;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--sello-dorado), #f0d592);
            border: 4px dashed var(--gris-texto);
            transform: rotate(-10deg);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 3;
        }
        
        .sello::before {
            content: "‚≠ê";
            font-size: 3.5rem;
            color: var(--gris-texto);
        }

        /* --- REGLA CR√çTICA DE AISLAMIENTO PARA PDF (SOLUCI√ìN FINAL) --- */
        @media print {
            body * { 
                visibility: hidden; 
            }
            .certificado-container, .certificado-container * { 
                visibility: visible; 
            }
            .certificado-container {
                position: absolute; 
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 0;
                page-break-after: avoid !important; 
                page-break-inside: avoid !important;
            }
            body {
                margin: 0 !important;
                padding: 0 !important;
            }
            .botones-accion {
                display: none !important; 
            }
        }
    </style>
</head>
<body>
    <div class="certificado-container" id="certificado">
        <div class="header-certificado">
            <div class="logo-space" id="logoContainer"></div>
            <h1 class="titulo-certificado">Certificado de Lealtad Consciente</h1>
            <div class="subtitulo-certificado">Compromiso con el Futuro Planetario</div>
            <div class="numero-certificado" id="numeroCertificado">BS-2025-000001</div>
        </div>
        
        <div class="cuerpo-certificado">
            <div class="texto-compromiso">
                <strong>Yo, <span id="nombreGuardian">____________________</span>,</strong> como Guardi√°n Consciente de BlueSphere, me comprometo activamente con la preservaci√≥n 
                de nuestro planeta y adopto los siguientes h√°bitos sostenibles como parte de mi 
                contribuci√≥n a un futuro m√°s verde y equilibrado.
            </div>
            
            <div class="compromisos-lista">
                <h3>üåø Mis Compromisos Ambientales Esenciales</h3>
                <div class="compromiso-item">
                    <div class="compromiso-emoji">üåä</div>
                    <div class="compromiso-texto">
                        <strong>Reducci√≥n de Pl√°sticos:</strong> Eliminar el uso de pl√°sticos de un solo uso 
                        y optar por alternativas reutilizables en mi vida diaria.
                    </div>
                </div>
                <div class="compromiso-item">
                    <div class="compromiso-emoji">üö≤</div>
                    <div class="compromiso-texto">
                        <strong>Movilidad Sostenible:</strong> Utilizar transporte p√∫blico, bicicleta o 
                        caminar para desplazamientos cortos, reduciendo mi huella de carbono.
                    </div>
                </div>
                <div class="compromiso-item">
                    <div class="compromiso-emoji">üíß</div>
                    <div class="compromiso-texto">
                        <strong>Conservaci√≥n del Agua:</strong> Implementar pr√°cticas de ahorro de agua 
                        en el hogar y ser consciente de su uso responsable.
                    </div>
                </div>
                <div class="compromiso-item">
                    <div class="compromiso-emoji">üå±</div>
                    <div class="compromiso-texto">
                        <strong>Consumo Responsable:</strong> Elegir productos de empresas sostenibles 
                        y reducir el consumo innecesario de recursos.
                    </div>
                </div>
            </div>
            
            <div class="compromisos-avanzados">
                <h3>üåü Mis Compromisos Avanzados</h3>
                <div class="compromiso-item">
                    <div class="compromiso-emoji">üçÉ</div>
                    <div class="compromiso-texto">
                        <strong>Alimentaci√≥n Consciente:</strong> Reducir el consumo de carne e incrementar el consumo de productos locales y de temporada.
                    </div>
                </div>
                <div class="compromiso-item">
                    <div class="compromiso-emoji">‚ôªÔ∏è</div>
                    <div class="compromiso-texto">
                        <strong>Gesti√≥n de Residuos:</strong> Practicar consistentemente el reciclaje y el compostaje de residuos org√°nicos.
                    </div>
                </div>
                <div class="compromiso-item">
                    <div class="compromiso-emoji">üìö</div>
                    <div class="compromiso-texto">
                        <strong>Educaci√≥n y Advocacy:</strong> Compartir conocimientos sobre sostenibilidad con mi comunidad y apoyar pol√≠ticas medioambientales.
                    </div>
                </div>
            </div>
            
            <div class="botones-accion">
                <button class="btn-certificado btn-descargar" onclick="descargarCertificado()" disabled id="btnDescargar">
                    üìÑ Descargar Certificado
                </button>
            </div>
            
            <div class="hashtag">
                √önete a la conversaci√≥n: <span>#Guardi√°nBluesphere</span>
            </div>
        </div>
        
        <div class="pie-certificado">
            <div class="fecha-emision" id="fechaEmision">17 de Noviembre de 2025</div>
            <div class="codigo-qr" id="codigoQR">
                C√≥digo QR<br>Verificaci√≥n
            </div>
            <div class="codigo-autenticacion">C√ìDIGO: <span id="unique-code-footer"></span></div>
        </div>
        
        <div class="sello">
            <div class="sello-texto">COMPROMISO VERIFICADO</div>
        </div>
    </div>
    
    <script>
        // --- 1. FUNCIONES UTILITARIAS ---
        function obtenerFechaActual() {
            const ahora = new Date();
            const opciones = { year: 'numeric', month: 'long', day: 'numeric' };
            return ahora.toLocaleDateString('es-ES', opciones);
        }

        // --- 2. CEREBRO AUTOM√ÅTICO (LO NUEVO) ---
        document.addEventListener('DOMContentLoaded', function() {
            
            // A. Leer la "Mochila" (Datos de la URL que envi√≥ el Portal)
            const params = new URLSearchParams(window.location.search);
            const nombreURL = params.get('nombre');
            const codigoURL = params.get('codigo');

            // B. Identificar elementos del Certificado
            const elNombre = document.getElementById('nombreGuardian');
            const elNumero = document.getElementById('numeroCertificado');
            const elFecha = document.getElementById('fechaEmision');
            const elCodigoFooter = document.getElementById('unique-code-footer'); // Nuevo placeholder

            const btnDescargar = document.getElementById('btnDescargar');
            
            // C. Poner Fecha de Hoy
            elFecha.textContent = obtenerFechaActual();

            // D. L√≥gica del C√ìDIGO
            if (codigoURL && codigoURL !== "undefined") {
                elNumero.textContent = codigoURL;
                elCodigoFooter.textContent = codigoURL; // Inyectar c√≥digo en el footer
            } else {
                // Si no hay c√≥digo (entr√≥ directo), generamos uno de respaldo
                const codigoRespaldo = 'BS-2025-' + Math.floor(Math.random() * 10000);
                elNumero.textContent = codigoRespaldo;
                elCodigoFooter.textContent = codigoRespaldo; // Inyectar c√≥digo en el footer
            }

            // E. L√≥gica del NOMBRE (Aqu√≠ ocurre la magia)
            if (nombreURL && nombreURL !== "null" && nombreURL !== "") {
                // 1. Escribir el nombre autom√°ticamente
                elNombre.textContent = nombreURL;
                elNombre.style.textTransform = "uppercase"; 
                
                // 2. Ocultar los campos manuales (No existe inputFirma ni btnFirmar, fueron eliminados)
                
                // 3. Activar descarga inmediata
                btnDescargar.disabled = false;
                btnDescargar.style.opacity = "1";
                btnDescargar.innerHTML = "üìÑ Descargar PDF Ahora";
                
                // A√±adir clase visual
                document.getElementById('certificado').classList.add('certificado-firmado');
            } 
        });

        // --- 3. L√ìGICA DE DESCARGA (IMPRIMIR PDF) ---
        function descargarCertificado() {
            const btn = document.getElementById('btnDescargar');
            if(btn.disabled) return alert("Firma primero.");
            
            // Ocultamos el bot√≥n temporalmente para que no salga en la impresi√≥n
            const botones = document.querySelector('.botones-accion');
            botones.style.display = 'none';

            // Imprimir (El navegador genera el PDF)
            window.print();

            // Volver a mostrar botones despu√©s de imprimir
            setTimeout(() => {
                botones.style.display = 'flex';
            }, 1000);
        }

        /* La funci√≥n firmarCertificado() y la l√≥gica manual fueron eliminadas para evitar redundancia. */
    </script>
</body>
</html>
