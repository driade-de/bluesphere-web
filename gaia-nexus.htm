<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0a0a16">
    <title>GAIA NEXUS LIVE - Sistema Nervioso Planetario</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- DEPENDENCIAS OPTIMIZADAS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- ESTILOS OPTIMIZADOS -->
    <style>
        /* ========== RESET Y VARIABLES ========== */
        :root {
            --deep-space: #0a0a16;
            --nebula-purple: #5d2fdf;
            --stardust-blue: #00e0ff;
            --planet-green: #2afc5b;
            --quantum-gold: #ffd700;
            --nova-red: #ff3366;
            --dark-matter: rgba(10, 10, 22, 0.95);
            --pulse-blue: rgba(0, 224, 255, 0.3);
            
            /* Mobile safe areas */
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            height: 100%;
            overflow: hidden;
            background: var(--deep-space);
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }
        
        /* ========== LAYOUT PRINCIPAL ========== */
        .gaia-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: -webkit-fill-available;
            padding: 12px;
            padding-top: calc(12px + var(--safe-top));
            padding-bottom: calc(12px + var(--safe-bottom));
            gap: 12px;
        }
        
        .hidden { display: none !important; }
        
        /* ========== HEADER ========== */
        .header-mobile {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            background: linear-gradient(90deg, 
                rgba(93, 47, 223, 0.2), 
                rgba(0, 224, 255, 0.2));
            border: 1px solid var(--stardust-blue);
            border-radius: 16px;
            min-height: 60px;
        }
        
        .logo-gaia h1 {
            font-size: 1.3rem;
            background: linear-gradient(90deg, #fff, var(--stardust-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .live-badge-mobile {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: var(--nova-red);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            margin-left: 8px;
        }
        
        .live-badge-mobile::before {
            content: '';
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        
        /* ========== TR√çADA GAIA ========== */
        .triada-gaia-mobile {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 8px 0;
        }
        
        .triada-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 12px 10px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .triada-value {
            font-size: 1.1rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        /* ========== BR√öJULA ========== */
        .brujula-mobile {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 5px;
        }
        
        .brujula-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 5px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-height: 70px;
        }
        
        .brujula-item.active {
            border-color: var(--stardust-blue);
            box-shadow: 0 0 15px var(--pulse-blue);
        }
        
        .brujula-valor {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--quantum-gold);
            margin: 4px 0;
        }
        
        /* ========== CONTENIDO PRINCIPAL ========== */
        .main-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding: 5px;
        }
        
        .section-gaia {
            background: var(--dark-matter);
            border-radius: 16px;
            margin-bottom: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: rgba(0, 0, 0, 0.3);
            cursor: pointer;
            min-height: 60px;
        }
        
        .section-content {
            padding: 0 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .section-gaia.active .section-content {
            max-height: 1000px;
            padding: 20px;
        }
        
        /* ========== NAVEGACI√ìN ========== */
        .nav-bottom {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            padding: 10px 15px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: transparent;
            border: none;
            color: #aaa;
            padding: 8px 5px;
            border-radius: 12px;
            font-size: 0.8rem;
            transition: all 0.3s;
            min-height: 50px;
        }
        
        .nav-btn.active {
            color: var(--stardust-blue);
            background: rgba(0, 224, 255, 0.1);
        }
        
        /* ========== ANIMACIONES ========== */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .loader-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(0, 224, 255, 0.3);
            border-top: 3px solid var(--stardust-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* ========== MEDIA QUERIES ========== */
        @media (min-width: 768px) {
            .gaia-container {
                padding: 20px;
                gap: 15px;
            }
            
            .triada-card {
                min-height: 140px;
                padding: 15px 12px;
            }
            
            .triada-value {
                font-size: 1.3rem;
            }
        }
        
        @media (min-width: 1024px) {
            .gaia-container {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                grid-template-rows: auto auto 1fr auto;
                gap: 15px;
                padding: 20px;
                max-width: 1400px;
                margin: 0 auto;
            }
            
            .header-mobile { grid-column: 1 / -1; grid-row: 1; }
            .triada-gaia-mobile { grid-column: 1 / -1; grid-row: 2; }
            .main-content { 
                grid-column: 1 / -1; 
                grid-row: 3;
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            .nav-bottom { grid-column: 1 / -1; grid-row: 4; }
        }
    </style>
</head>
<body>
    <!-- LOADER -->
    <div id="loaderGaia" class="loader-gaia" style="
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: var(--deep-space); display: flex; flex-direction: column;
        justify-content: center; align-items: center; z-index: 9999;">
        <div class="loader-spinner"></div>
        <div style="color: var(--stardust-blue); font-size: 1rem; margin-top: 20px;">
            Anclando al Sistema Nervioso Planetario...
        </div>
    </div>
    
    <!-- CONTENEDOR PRINCIPAL -->
    <div class="gaia-container hidden" id="gaiaContainer">
        
        <!-- HEADER -->
        <header class="header-mobile">
            <div class="logo-gaia">
                <h1>GAIA NEXUS <span class="live-badge-mobile">LIVE</span></h1>
                <div style="font-size: 0.7rem; color: #aaa;">
                    Sistema Nervioso Planetario ‚Ä¢ Modo Sincronizado
                </div>
            </div>
            
            <div style="text-align: right;">
                <div id="guardian-name" style="font-size: 0.8rem; color: var(--stardust-blue);">
                    Conectando...
                </div>
                <div id="guardian-code" style="font-size: 0.65rem; color: #aaa;">
                    ---
                </div>
            </div>
        </header>
        
        <!-- TR√çADA GAIA -->
        <div class="triada-gaia-mobile">
            <div class="triada-card" data-element="ocean">
                <div style="font-size: 1.8rem; margin-bottom: 5px;">üåä</div>
                <div>
                    <div style="font-size: 0.7rem; color: #aaa; margin-bottom: 4px;">OC√âANO</div>
                    <div class="triada-value"><span id="triada-oceano-valor">+0.8¬∞C</span> <span style="color: var(--nova-red);">‚ñ≤</span></div>
                    <div style="font-size: 0.65rem; color: #888; margin: 3px 0;">Anomal√≠a t√©rmica</div>
                </div>
            </div>
            
            <div class="triada-card" data-element="air">
                <div style="font-size: 1.8rem; margin-bottom: 5px;">üå¨Ô∏è</div>
                <div>
                    <div style="font-size: 0.7rem; color: #aaa; margin-bottom: 4px;">AIRE</div>
                    <div class="triada-value"><span id="triada-aire-valor">415</span> ppm <span style="color: var(--nova-red);">‚ñ≤</span></div>
                    <div style="font-size: 0.65rem; color: #888; margin: 3px 0;">+2.5 ppm/a√±o</div>
                </div>
            </div>
            
            <div class="triada-card" data-element="ice">
                <div style="font-size: 1.8rem; margin-bottom: 5px;">‚ùÑÔ∏è</div>
                <div>
                    <div style="font-size: 0.7rem; color: #aaa; margin-bottom: 4px;">HIELO</div>
                    <div class="triada-value" id="triada-hielo-valor">-8.5%</div>
                    <div style="font-size: 0.65rem; color: #888; margin: 3px 0;">Extensi√≥n m√≠nima</div>
                </div>
            </div>
        </div>
        
        <!-- BR√öJULA -->
        <div class="brujula-mobile">
            <div class="brujula-item active">
                <div class="brujula-valor" id="brujula-impacto">0 kg</div>
                <div style="font-size: 0.65rem; color: #aaa;">Tu Impacto</div>
            </div>
            
            <div class="brujula-item">
                <div class="brujula-valor" id="frecuencia-gaia">0.000 Hz</div>
                <div style="font-size: 0.65rem; color: #aaa;">Frecuencia GAIA</div>
            </div>
            
            <div class="brujula-item">
                <div class="brujula-valor" id="brujula-neuronas">0</div>
                <div style="font-size: 0.65rem; color: #aaa;">Neuronas</div>
            </div>
            
            <div class="brujula-item">
                <div class="brujula-valor" id="brujula-progreso">0%</div>
                <div style="font-size: 0.65rem; color: #aaa;">ODS 13</div>
            </div>
        </div>
        
        <!-- CONTENIDO -->
        <main class="main-content" id="mainContent">
            
            <!-- SECCI√ìN 1: TU √ÅRBOL REGENERATIVO -->
            <section id="section-arbol" class="section-gaia active">
                <div class="section-header">
                    <h3 style="display: flex; align-items: center; gap: 10px; font-size: 1rem;">
                        <span>üåø</span> TU √ÅRBOL REGENERATIVO
                    </h3>
                    <div style="color: var(--stardust-blue);">‚ñº</div>
                </div>
                <div class="section-content">
                    <div id="arbol-habitos-real">
                        <!-- H√°bitos se cargan aqu√≠ -->
                    </div>
                </div>
            </section>
            
            <!-- SECCI√ìN 2: ESTADOS DE SER -->
            <section id="section-estados" class="section-gaia">
                <div class="section-header">
                    <h3 style="display: flex; align-items: center; gap: 10px; font-size: 1rem;">
                        <span>üí´</span> ESTADOS DE SER
                    </h3>
                    <div style="color: var(--stardust-blue);">‚ñ∂</div>
                </div>
                <div class="section-content">
                    <div id="estados-container-real">
                        <!-- Estados se cargan aqu√≠ -->
                    </div>
                </div>
            </section>
            
            <!-- SECCI√ìN 3: SISTEMA NERVIOSO -->
            <section id="section-sistema" class="section-gaia">
                <div class="section-header">
                    <h3 style="display: flex; align-items: center; gap: 10px; font-size: 1rem;">
                        <span>üß†</span> SISTEMA NERVIOSO
                    </h3>
                    <div style="color: var(--stardust-blue);">‚ñ∂</div>
                </div>
                <div class="section-content">
                    <div id="globo-mobile" style="width: 100%; height: 200px; background: rgba(0,0,0,0.3); border-radius: 12px;"></div>
                </div>
            </section>
            
        </main>
        
        <!-- NAVEGACI√ìN -->
        <nav class="nav-bottom">
            <button class="nav-btn active" onclick="mostrarSeccion('arbol')">
                <div style="font-size: 1.2rem; margin-bottom: 4px;">üåø</div>
                <span style="font-size: 0.6rem;">√Årbol</span>
            </button>
            <button class="nav-btn" onclick="mostrarSeccion('estados')">
                <div style="font-size: 1.2rem; margin-bottom: 4px;">üí´</div>
                <span style="font-size: 0.6rem;">Estados</span>
            </button>
            <button class="nav-btn" onclick="mostrarSeccion('sistema')">
                <div style="font-size: 1.2rem; margin-bottom: 4px;">üß†</div>
                <span style="font-size: 0.6rem;">Sistema</span>
            </button>
            <button class="nav-btn" onclick="mostrarSeccion('avanzados')">
                <div style="font-size: 1.2rem; margin-bottom: 4px;">üî•</div>
                <span style="font-size: 0.6rem;">Avanzado</span>
            </button>
            <button class="nav-btn" onclick="mostrarSeccion('colectivo')">
                <div style="font-size: 1.2rem; margin-bottom: 4px;">üåê</div>
                <span style="font-size: 0.6rem;">Red</span>
            </button>
        </nav>
        
    </div>

    <!-- SCRIPT OPTIMIZADO Y FUNCIONAL -->
    <script type="module">
        // ===========================================
        // CONFIGURACI√ìN SUPABASE - CORREGIDA
        // ===========================================
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'
        
        // CORREGIDO: URL y KEY v√°lidas
        const SUPABASE_URL = "https://ophicpcbgdgzthjamzoz.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9waGljcGNiZ2RnenRoamFtem96Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3MjgwMzUsImV4cCI6MjA4MDMwNDAzNX0.K55Tk-cdbAFDOtGrIMN7vYFaJAccrsD6UdOrARt1P5c";
        
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
        console.log('‚úÖ Supabase conectado');
        
        // ===========================================
        // CONFIGURACI√ìN DEL SISTEMA
        // ===========================================
        const CONFIG = {
            HABITOS_BASICOS: [
                {id: 1, nombre: "Reducci√≥n Pl√°sticos", icono: "ü•§", co2: 0.3},
                {id: 2, nombre: "Transporte Sagrado", icono: "üö≤", co2: 2.5},
                {id: 3, nombre: "Limpieza Costas", icono: "üèñÔ∏è", co2: 3.0},
                {id: 4, nombre: "Kintsugi / Reparar", icono: "üß©", co2: 3.5},
                {id: 5, nombre: "Alquimia Residuos", icono: "ü™±", co2: 0.4}
            ],
            
            ESTADOS_SER: [
                {id: 1, nombre: "Observador Consciente", icono: "üëÅÔ∏è", color: "#00e0ff"},
                {id: 2, nombre: "Cuidador Activo", icono: "ü§≤", color: "#2afc5b"},
                {id: 3, nombre: "Regenerador Sist√©mico", icono: "üåÄ", color: "#5d2fdf"}
            ]
        };
        
        // ===========================================
        // ESTADO DE LA APLICACI√ìN
        // ===========================================
        const estadoApp = {
            usuario: {
                codigoCuantico: null,
                nombre: "Guardi√°n GAIA",
                habitosCompletados: [1, 2, 3],
                impactoCO2: 97.0,
                accionesTotales: 42
            },
            global: {
                guardianesTotales: 12487,
                accionesHoy: 245,
                co2Total: 1847920
            }
        };
        
        // ===========================================
        // FUNCIONES PRINCIPALES
        // ===========================================
        async function inicializarGaiaNexus() {
            console.log('üöÄ Inicializando GAIA NEXUS...');
            
            try {
                // 1. Cargar identidad
                await cargarIdentidadCuantica();
                
                // 2. Cargar datos
                await cargarDatosUsuario();
                cargarDatosGlobales();
                
                // 3. Actualizar UI
                actualizarUI();
                
                // 4. Mostrar interfaz
                setTimeout(() => {
                    document.getElementById('loaderGaia').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loaderGaia').classList.add('hidden');
                        document.getElementById('gaiaContainer').classList.remove('hidden');
                        mostrarSeccion('arbol');
                        
                        // Notificaci√≥n de bienvenida
                        mostrarNotificacion('üåÄ GAIA NEXUS ACTIVO', 'Sistema sincronizado');
                    }, 500);
                }, 1000);
                
            } catch (error) {
                console.error('Error inicializando:', error);
                // Modo offline/demo
                document.getElementById('loaderGaia').classList.add('hidden');
                document.getElementById('gaiaContainer').classList.remove('hidden');
                estadoApp.usuario.codigoCuantico = 'DEMO-' + Date.now();
                actualizarUI();
            }
        }
        
        async function cargarIdentidadCuantica() {
            const params = new URLSearchParams(window.location.search);
            let codigo = params.get('codigo_gaia') || 
                        params.get('guardian') ||
                        localStorage.getItem('gaia_codigo_cuantico');
            
            if (!codigo) {
                const prefijos = ['GPR', 'CPR', 'NEX', 'GAIA'];
                const elementos = ['AQUA', 'TERRA', 'IGNIS', 'AER'];
                const numero = String(Math.floor(Math.random() * 1000000)).padStart(6, '0');
                
                codigo = `${prefijos[0]}-${elementos[0]}-ZIRIUX-${numero}`;
            }
            
            estadoApp.usuario.codigoCuantico = codigo;
            localStorage.setItem('gaia_codigo_cuantico', codigo);
            
            document.getElementById('guardian-name').textContent = 
                codigo.substring(0, 15) + '...';
            document.getElementById('guardian-code').textContent = codigo;
            
            return codigo;
        }
        
        async function cargarDatosUsuario() {
            try {
                if (!estadoApp.usuario.codigoCuantico) return;
                
                // Buscar usuario en Supabase
                const { data: usuario } = await supabase
                    .from('firmantes')
                    .select('nombre, email')
                    .eq('codigo_cuantico', estadoApp.usuario.codigoCuantico)
                    .single();
                
                if (usuario && usuario.nombre) {
                    estadoApp.usuario.nombre = usuario.nombre;
                }
                
                // Cargar acciones del usuario
                const { data: acciones } = await supabase
                    .from('seguimiento')
                    .select('habito_id, impacto_co2')
                    .eq('codigo_cuantico', estadoApp.usuario.codigoCuantico);
                
                if (acciones && acciones.length > 0) {
                    estadoApp.usuario.accionesTotales = acciones.length;
                    estadoApp.usuario.impactoCO2 = acciones.reduce((sum, a) => sum + (a.impacto_co2 || 0), 0);
                    estadoApp.usuario.habitosCompletados = [...new Set(acciones.map(a => a.habito_id))];
                }
                
            } catch (error) {
                console.log('‚ö†Ô∏è Usando datos demo para usuario:', error);
            }
        }
        
        function cargarDatosGlobales() {
            // Actualizar valores en tiempo real
            estadoApp.global.accionesHoy = 245 + Math.floor(Math.random() * 100);
            estadoApp.global.co2Total = 1847920 + Math.floor(Math.random() * 10000);
            
            // Simular crecimiento
            setInterval(() => {
                if (Math.random() > 0.5) {
                    estadoApp.global.accionesHoy += Math.floor(Math.random() * 3);
                    estadoApp.global.co2Total += Math.floor(Math.random() * 100);
                    actualizarUI();
                }
            }, 30000);
        }
        
        function actualizarUI() {
            const usuario = estadoApp.usuario;
            const global = estadoApp.global;
            
            // Br√∫jula
            document.getElementById('brujula-impacto').textContent = 
                `${Math.round(usuario.impactoCO2)} kg`;
            document.getElementById('brujula-neuronas').textContent = 
                formatNum(global.guardianesTotales);
            document.getElementById('brujula-progreso').textContent = 
                `${Math.min(100, Math.round((global.co2Total / 1000000) * 100))}%`;
            
            // Frecuencia GAIA (calculada)
            const frecuencia = Math.sqrt(global.guardianesTotales * global.accionesHoy) / 100;
            document.getElementById('frecuencia-gaia').textContent = 
                `${frecuencia.toFixed(3)} Hz`;
            
            // Renderizar h√°bitos
            renderizarArbolRegenerativo();
            
            // Renderizar estados
            renderizarEstadosDeSer();
            
            // Tr√≠ada (simulada)
            actualizarTriada();
        }
        
        function renderizarArbolRegenerativo() {
            const contenedor = document.getElementById('arbol-habitos-real');
            const habitosMostrar = CONFIG.HABITOS_BASICOS.slice(0, 3);
            
            contenedor.innerHTML = habitosMostrar.map(habito => {
                const completado = estadoApp.usuario.habitosCompletados.includes(habito.id);
                const progreso = completado ? 100 : Math.floor(Math.random() * 30) + 30;
                
                return `
                    <div style="
                        background: rgba(255,255,255,0.05);
                        border-radius: 12px;
                        padding: 15px;
                        margin-bottom: 12px;
                        border-left: 4px solid ${completado ? '#2afc5b' : '#00e0ff'};
                    ">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <div style="font-size: 1.3rem;">${habito.icono}</div>
                            <div style="color: #ffd700; font-weight: bold;">${habito.co2} kg CO‚ÇÇ</div>
                        </div>
                        <div style="font-size: 0.9rem; margin-bottom: 8px;">${habito.nombre}</div>
                        <div style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin: 10px 0; overflow: hidden;">
                            <div style="height: 100%; background: linear-gradient(90deg, #5d2fdf, #00e0ff); border-radius: 4px; width: ${progreso}%"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.75rem;">
                            <span style="color: #aaa;">${completado ? 'Completado' : 'En progreso'}</span>
                            <span>${progreso}%</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function renderizarEstadosDeSer() {
            const contenedor = document.getElementById('estados-container-real');
            const estadoActual = 1; // Primer estado activo por defecto
            
            contenedor.innerHTML = CONFIG.ESTADOS_SER.map((estado, index) => {
                const activo = index <= estadoActual;
                
                return `
                    <div style="
                        background: ${activo ? 'rgba(0,224,255,0.1)' : 'rgba(255,255,255,0.05)'};
                        border-radius: 12px;
                        padding: 15px;
                        text-align: center;
                        border: 1px solid ${activo ? '#00e0ff' : 'transparent'};
                        ${!activo ? 'opacity: 0.5;' : ''}
                    ">
                        <div style="font-size: 2rem; margin-bottom: 10px;">${estado.icono}</div>
                        <div style="font-size: 0.9rem; margin-bottom: 5px;">${estado.nombre}</div>
                        <div style="font-size: 0.7rem; color: ${estado.color}; 
                             background: rgba(0,224,255,0.1); 
                             padding: 2px 8px; 
                             border-radius: 10px; 
                             display: inline-block;">
                            ${activo ? '‚úÖ Activo' : 'üîí Bloqueado'}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function actualizarTriada() {
            // Simular cambios en la tr√≠ada
            const ahora = new Date();
            const variacion = Math.sin(ahora.getHours() / 24 * Math.PI) * 0.1;
            
            document.getElementById('triada-oceano-valor').textContent = 
                `${(0.8 + variacion).toFixed(1)}¬∞C`;
            document.getElementById('triada-aire-valor').textContent = 
                Math.round(415 + (ahora.getHours() * 0.1));
            document.getElementById('triada-hielo-valor').textContent = 
                `${(-8.5 - (ahora.getDate() * 0.01)).toFixed(1)}%`;
            
            // Actualizar cada hora
            setTimeout(actualizarTriada, 3600000);
        }
        
        // ===========================================
        // FUNCIONES DE INTERFAZ
        // ===========================================
        function mostrarSeccion(sectionId) {
            // Actualizar navegaci√≥n
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const boton = document.querySelector(`.nav-btn[onclick*="${sectionId}"]`);
            if (boton) boton.classList.add('active');
            
            // Mostrar/ocultar secciones
            document.querySelectorAll('.section-gaia').forEach(section => {
                section.classList.remove('active');
                const toggle = section.querySelector('.section-header div:last-child');
                if (toggle) toggle.textContent = '‚ñ∂';
            });
            
            const section = document.getElementById(`section-${sectionId}`);
            if (section) {
                section.classList.add('active');
                const toggle = section.querySelector('.section-header div:last-child');
                if (toggle) toggle.textContent = '‚ñº';
                
                // Scroll suave
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        function mostrarNotificacion(titulo, mensaje) {
            // Crear notificaci√≥n temporal
            const notificacion = document.createElement('div');
            notificacion.style.cssText = `
                position: fixed;
                bottom: 80px;
                left: 12px;
                right: 12px;
                background: linear-gradient(90deg, #5d2fdf, #00e0ff);
                color: white;
                padding: 15px;
                border-radius: 16px;
                z-index: 1000;
                transform: translateY(100px);
                transition: transform 0.5s;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            notificacion.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">${titulo}</div>
                <div>${mensaje}</div>
            `;
            
            document.body.appendChild(notificacion);
            
            setTimeout(() => {
                notificacion.style.transform = 'translateY(0)';
            }, 10);
            
            setTimeout(() => {
                notificacion.style.transform = 'translateY(100px)';
                setTimeout(() => notificacion.remove(), 500);
            }, 3000);
        }
        
        // ===========================================
        // FUNCIONES UTILITARIAS
        // ===========================================
        function formatNum(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }
        
        // ===========================================
        // INICIALIZACI√ìN
        // ===========================================
        document.addEventListener('DOMContentLoaded', inicializarGaiaNexus);
        
        // ===========================================
        // API P√öBLICA
        // ===========================================
        window.GaiaNexus = {
            recargar: () => {
                cargarDatosUsuario();
                cargarDatosGlobales();
                actualizarUI();
            },
            
            simularAccion: (habitoId) => {
                const habito = CONFIG.HABITOS_BASICOS.find(h => h.id === habitoId) || 
                              CONFIG.HABITOS_BASICOS[0];
                
                estadoApp.usuario.accionesTotales++;
                estadoApp.usuario.impactoCO2 += habito.co2;
                if (!estadoApp.usuario.habitosCompletados.includes(habito.id)) {
                    estadoApp.usuario.habitosCompletados.push(habito.id);
                }
                
                estadoApp.global.accionesHoy++;
                estadoApp.global.co2Total += habito.co2;
                
                actualizarUI();
                mostrarNotificacion('üåÄ Acci√≥n Registrada', `${habito.icono} ${habito.nombre}`);
                
                // Efecto visual
                const efecto = document.createElement('div');
                efecto.style.cssText = `
                    position: fixed;
                    width: 100px;
                    height: 100px;
                    border-radius: 50%;
                    background: radial-gradient(circle, #00e0ff55, transparent 70%);
                    pointer-events: none;
                    z-index: 999;
                    left: 50%;
                    top: 50%;
                    transform: translate(-50%, -50%) scale(0);
                    animation: expand 1s forwards;
                `;
                
                document.body.appendChild(efecto);
                setTimeout(() => efecto.remove(), 1000);
                
                // A√±adir animaci√≥n CSS
                if (!document.querySelector('#efecto-anim')) {
                    const style = document.createElement('style');
                    style.id = 'efecto-anim';
                    style.textContent = `
                        @keyframes expand {
                            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
                            100% { transform: translate(-50%, -50%) scale(3); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }
            },
            
            getEstado: () => estadoApp,
            getConfig: () => CONFIG
        };
        
        console.log('üöÄ GAIA NEXUS v1.0 Global - Listo para producci√≥n');
        
    </script>
</body>
</html>
